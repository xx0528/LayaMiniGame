!function(){function t(){var e="";try{e=qq.getStorageSync("aldstat_op")}catch(t){e=qq.getStorageSync("aldstat_op")}if(""===e){if(""===u)return"";try{v=e=qq.getStorageSync(u),e&&qq.setStorageSync("aldstat_op",e)}catch(t){v=e=qq.getStorageSync(u),e&&qq.setStorageSync("aldstat_op",e)}}return e}function i(e){var t={};return"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e,n){t["[object "+e+"]"]=e.toLowerCase()}),null==e?e:"object"==typeof e||"function"==typeof e?t[function(e){return Object.prototype.toString.call(e)}.call(e)]||"object":typeof e}function c(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}function f(e,i){function r(){return new Promise(function(t,n){qq.request({url:"https://"+a+".aldwx.com/d.html",data:e,header:{se:p||"",op:v||"",img:k||""},method:"GET",fail:function(){t("")},success:function(e){t(200==e.statusCode?"":"status error")}})})}o.useOpen&&t(),y++,e.as=b,e.at=w,e.rq_c=y,e.ifo=d,e.ak=o.app_key,e.uu=l,e.v=n,e.st=Date.now(),e.ev=i,e.wsr=JSON.stringify(_),e.te=s,""!==function(e){if(void 0===e||""===e)return"";var t={};for(var n in e)"rawData"!=n&&"errMsg"!=n&&(t[n]=e[n]);return t}(e.ufo)&&(e.ufo=e.ufo),e.ec=m,o.useOpen?""===v?C.push(r):(qq.Queue.push(r),C.concat()):qq.Queue.push(r)}function h(e){var t={};for(var n in e)t[n]=e[n];return t}function q(e){for(var t="",n=0;n<e.length;n++)e[n].length>t.length&&(t=e[n]);return t}var n="2.0.0",a="qg.log",s="qg";qq,s="qg",wx=qq;var o=require("./ald-game-conf");""===o.app_key&&console.error("请在配置文件中填写您的app_key"),o.useOpen&&console.warn("提示：开启了useOpen配置后，如果不上传用户opendId则不会上报数据。"),o.app_key=o.app_key.replace(/\s/g,"");var u=o.openKey;qq.request({url:"https://"+a+".aldwx.com/config/app.json",method:"GET",success:function(e){200===e.statusCode&&(e.data.version!=n&&console.warn("您的SDK不是最新版本，请尽快升级！"),e.data.warn&&console.warn(e.data.warn),e.data.error&&console.error(e.data.error))}});var d="",l=function(){var e="";try{e=qq.getStorageSync("aldstat_uuid"),qq.setStorageSync("ald_ifo",!0)}catch(t){e="uuid_getstoragesync"}if(e)d=!1;else{e=c(),d=!0;try{qq.setStorageSync("aldstat_uuid",e)}catch(e){qq.setStorageSync("aldstat_uuid","uuid_getstoragesync")}}return e}(),g={},p="",v=t(),m=0,y="",_=qq.getLaunchOptionsSync(),S=Date.now(),w=""+Date.now()+Math.floor(1e7*Math.random()),b=""+Date.now()+Math.floor(1e7*Math.random()),I=0,O="",k="",j=!0,M=!1,x=["aldSendEvent","aldOnShareAppMessage","aldShareAppMessage","aldSendSession","aldSendOpenid","aldLevelEvent"],N=["payStart","paySuccess","payFail","die","revive","tools","award"],D=["complete","fail"];void 0===qq.Queue&&(qq.Queue=new function(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var e=this;this.push=function(t){this.tasks.push(new Promise(function(n,r){var a=function(){e.activeCount++,t().then(function(e){n(e)}).then(function(){e.next()})};e.activeCount<e.concurrency?a():e.queue.push(a)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){e.activeCount--,e.queue.length>0&&e.queue.shift()()}},qq.Queue.all());var C=new function(){this.request=[],this.push=function(e){this.request.length>=18?(this.request.shift(),this.request.push(e)):this.request.push(e)},this.concat=function(){this.request.map(function(e){qq.Queue.push(e)}),this.request=[]}};Promise.all([new Promise(function(e,t){qq.getSetting({success:function(t){t.authSetting["scope.userInfo"]?qq.getUserInfo({success:function(t){k=q(t.userInfo.avatarUrl.split("/")),e(t)},fail:function(){e("")}}):e("")},fail:function(){e("")}})}),new Promise(function(e,t){qq.getNetworkType({success:function(t){e(t)},fail:function(){e("")}})}),new Promise(function(e,t){o.getLocation?qq.getLocation({success:function(t){e(t)},fail:function(){e("")}}):qq.getSetting({success:function(t){t.authSetting["scope.userLocation"]?(qq.getLocation({success:function(t){e(t)},fail:function(){e("")}}),e("")):e("")},fail:function(){e("")}})})]).then(function(e){""!==e[2]?(g.lat=e[2].latitude||"",g.lng=e[2].longitude||"",g.spd=e[2].speed||""):(g.lat="",g.lng="",g.spd=""),""!==e[1]?g.nt=e[1].networkType||"":g.nt="";var t=h(g);""!==e[0]&&(t.ufo=e[0],O=e[0]),f(t,"init")}),qq.onShow(function(e){if((_=e).scene,e.scene,I=Date.now(),!j&&!M){w=""+Date.now()+Math.floor(1e7*Math.random()),d=!1;try{qq.setStorageSync("ald_ifo",!1)}catch(e){}}j=!1,M=!1;var t=h(g),n=h(g);t.sm=I-S,void 0!==e.query&&void 0!==e.query.ald_share_src&&e.shareTicket&&"1044"===e.scene?(n.tp="ald_share_click",new Promise(function(e,t){"1044"==_.scene?qq.getShareInfo({shareTicket:_.shareTicket,success:function(t){e(t)},fail:function(){e("")}}):e("")}).then(function(e){n.ct=e,f(n,"event")})):void 0!==e.query&&void 0!==e.query.ald_share_src&&(n.tp="ald_share_click",n.ct="1",f(n,"event")),""===O&&qq.getSetting({success:function(e){e.authSetting["scope.userInfo"]&&qq.getUserInfo({success:function(e){var t=h(g);t.ufo=JSON.stringify(e),O=e,k=q(e.userInfo.avatarUrl.split("/")),f(t,"ald_ufo")}})}}),f(t,"show")}),qq.onHide(function(){var e=h(g);e.dr=Date.now()-I,f(e,"hide")}),qq.onError(function(e){var t=h(g);t.tp="ald_error_message",t.ct=e,m++,f(t,"event")});var E={aldSendEvent:function(e,t){var n=h(g);if(""!==e&&"string"==typeof e&&e.length<=255)if(n.tp=e,"string"==typeof t&&t.length<=255)n.ct=String(t),f(n,"event");else if("object"==typeof t){if(JSON.stringify(t).length>=255)return void console.error("自定义事件参数不能超过255个字符");if(function(e){for(var t in e)if("object"==typeof e[t]&&null!==e[t])return!0;return!1}(t))return void console.error("事件参数，参数内部只支持Number,String等类型，请参考接入文档");for(var r in t)"number"==typeof t[r]&&(t[r]=t[r]+"s##");n.ct=JSON.stringify(t),f(n,"event")}else void 0===t||""===t?f(n,"event"):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符");else console.error("事件名称必须为String类型且不能超过255个字符")},aldOnShareAppMessage:function(e){qq.onShareAppMessage(function(){M=!0;var t=e(),n="";n=void 0!==_.query&&void 0!==_.query.ald_share_src?void 0!==t.query?(_.query.ald_share_src.indexOf(l),t.query+"&ald_share_src="+_.query.ald_share_src+","+l):(_.query.ald_share_src.indexOf(l),"ald_share_src="+_.query.ald_share_src+","+l):void 0!==t.query?t.query+"&ald_share_src="+l:"ald_share_src="+l,"undefined"!=i(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n;var r=h(g);return r.ct=t,r.ct.sho=1,r.tp="ald_share_chain",f(r,"event"),t})},aldShareAppMessage:function(e){M=!0;var t=e,n="";n=void 0!==_.query&&void 0!==_.query.ald_share_src?void 0!==t.query?(_.query.ald_share_src.indexOf(l),t.query+"&ald_share_src="+_.query.ald_share_src+","+l):(_.query.ald_share_src.indexOf(l),"ald_share_src="+_.query.ald_share_src+","+l):void 0!==t.query?t.query+"&ald_share_src="+l:"ald_share_src="+l;var r=h(g);"undefined"!=i(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n,r.ct=t,r.tp="ald_share_chain",f(r,"event"),qq.shareAppMessage(t)},aldSendSession:function(e){if(""!==e&&e){var t=h(g);t.tp="session",t.ct="session",p=e,""===O?qq.getSetting({success:function(e){e.authSetting["scope.userInfo"]?qq.getUserInfo({success:function(e){t.ufo=e,f(t,"event")}}):f(t,"event")}}):(t.ufo=O,""!==O&&(t.gid=""),f(t,"event"))}else console.error("请传入从后台获取的session_key")},aldSendOpenid:function(e){if(!e||28!=e.length&&32!=e.length)console.error("openID不符合规则");else{v=e,qq.setStorageSync("aldstat_op",e);var t=h(g);t.tp="openid",t.ct="openid",f(t,"event")}}};qq.aldStage=new function(){function e(e){return!/^\d+(.\d+)*$/.test(e.stageId)||e.stageId.length>32?(console.warn("关卡stageId必须符合传参规则,请参考文档。"),!1):!("string"!==i(e.stageName)||e.stageName.length>32)||(console.warn("关卡名称为必传字段,且长度小于32个字符,请参考文档"),!1)}var t="",n="",r=0;this.onStart=function(a){if(e(a)){var s={};r=Date.now(),s.sid=a.stageId,s.snm=a.stageName,s.state="start",n=c(),t=s,("string"===i(a.userId)&&a.userId)<32&&(this.uid=a.uid),this.request()}},this.onRunning=function(n){if(e(n)){var r={params:{}};if(("string"===i(n.userId)&&n.userId)<32&&(this.uid=n.uid),N.join(",").indexOf(n.event+","),"string"!==i(n.event)||-1===N.join(",").indexOf(n.event+","))return void console.warn("关卡running状态中仅支持"+N.join(",")+"事件类型，且为必传字段，详情请参考文档。");if(r.event=n.event,"object"!==i(n.params))return void console.warn("关卡running状态中params为必传字段，且该字段需为Object类型，详情请参考文档。");if("string"!==i(n.params.itemName)||n.params.itemName.length>32)return void console.warn("道具/商品名称为必传字段，且长度小于32个字符，详情请参考文档");r.params.itnm=n.params.itemName,"string"===i(n.params.itemId)&&n.params.itemId.length<32&&(r.params.itid=n.params.itemId),"number"===i(n.params.itemCount)&&n.params.itemCount.length<32?r.params.itco=n.params.itemCount:r.params.itco=1,-1!==n.event.indexOf("pay")&&("number"===i(n.params.itemMoney)&&n.params.itemMoney.length<32?r.params.money=n.params.itemMoney:r.params.money=0),"string"===i(n.params.desc)&&n.params.desc.length<64&&(r.params.desc=n.params.desc),r.state="running",r.sid=n.stageId,r.snm=n.stageName,t=r,this.request()}},this.onEnd=function(n){if(e(n)){var a={state:"end"};if(("string"===i(n.userId)&&n.userId)<32&&(this.uid=n.uid),!i(n.event)&&-1!==D.join(",").indexOf(n.event+","))return void D.join(",");a.sid=n.stageId,a.snm=n.stageName,a.event=n.event,a.sdr=0!==r?Date.now()-r:"",a.params={},"object"===i(n.params)&&"string"===i(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),t=a,this.request()}},this.request=function(){var e=h(g);t.ss=n,e.ct=t,f(e,"screen")}};for(var P=0;P<x.length;P++)!function(e,t){Object.defineProperty(qq,e,{value:t,writable:!1,enumerable:!0,configurable:!0})}(x[P],E[x[P]]);try{var L=qq.getSystemInfoSync();g.br=L.brand||"",g.md=L.model,g.pr=L.pixelRatio,g.sw=L.screenWidth,g.sh=L.screenHeight,g.ww=L.windowWidth,g.wh=L.windowHeight,g.lang=L.language,g.wv=L.version,g.sv=L.system,g.wvv=L.platform,g.fs=L.fontSizeSetting,g.wsdk=L.SDKVersion,g.bh=L.benchmarkLevel||"",g.bt=L.battery||"",g.wf=L.wifiSignal||"",g.lng="",g.lat="",g.nt="",g.spd="",g.ufo=""}catch(e){}}();