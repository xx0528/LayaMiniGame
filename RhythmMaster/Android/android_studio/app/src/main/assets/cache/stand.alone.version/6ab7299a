var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();!function(){function e(t,n,a){function o(r,s){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return o(n||e)},c,c.exports,e,t,n,a)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<a.length;r++)o(a[r]);return o}return e}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a;!function(e){e.None="",e.ReportAdClickSuccess="广告导出成功",e.ReportAdClickFail="广告导出失败"}(a=n.ALDEventDef||(n.ALDEventDef={}));var o=function(){function e(){}return e.aldSendEvent=function(e,t){var n=e;Laya.Browser.onMiniGame&&Laya.Browser.window.wx.aldSendEvent(n,t)},e.aldSendReportAdClickSuccess=function(t){var n=a.ReportAdClickSuccess+" "+t.title+":"+String(t.appid),o=e;o.aldSendEvent(n,{"导出成功":t.title+":"+String(t.appid)})},e.aldSendReportAdClickFail=function(t){var n=a.ReportAdClickFail+" "+t.title+":"+String(t.appid),o=e;o.aldSendEvent(n,{"导出失败":t.title+":"+String(t.appid)})},e}();n["default"]=o},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){}return e.AppID="",e.ResServer="",e.LocalTestReServer="subRes",e.Versions="0.0.0",e}();n["default"]=a},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../AppConfig"),o=function(){function e(){this.banner=0,this.wudian=0,this.wudianTime_01=2e3,this.wudianTime_01PreLoad=500,this.shipintubiao=1,this.wudianAvailableTime={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0}}return Object.defineProperty(e.prototype,"wudianTimeAvaliable",{get:function(){return 1==this.wudianAvailableTime[(new Date).getHours()]},enumerable:!0,configurable:!0}),e}();n.AppSwitchData=o;var i=function(){function e(){this._data=new Array}return e.getInstance=function(){return null==e._instance&&(e._instance=e.load()),e._instance},e.load=function(){var t=new e,n=Laya.loader.getRes(a["default"].ResServer+"/json/appswitch.json");if(n){for(var i=0;i<n.length;++i){var r=n[i],s=new o;s.banner=Number(r.banner),s.wudian=Number(r.wudian),s.wudianTime_01=Number(r.wudianTime_01),s.wudianTime_01PreLoad=Number(r.wudianTime_01PreLoad),s.shipintubiao=Number(r.shipintubiao),s.wudianAvailableTime=Object(r.wudianTime),t._data.push(s)}return t}return t._data.push(new o),t},e.prototype.getAppSwitchData=function(){return this._data[0]},e}();n["default"]=i},{"../AppConfig":2}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a;!function(e){e[e.None=0]="None",e[e.App_CloseFirstLoadingView=500]="App_CloseFirstLoadingView",e[e.AD_OnShareAdFail=501]="AD_OnShareAdFail",e[e.Game_OnViewOpen=600]="Game_OnViewOpen",e[e.Game_OnViewClose=601]="Game_OnViewClose",e[e.Game_OnUserMoneyChange=701]="Game_OnUserMoneyChange",e[e.Game_OnUserCrystalChange=702]="Game_OnUserCrystalChange",e[e.Game_OnLevelStart=1e3]="Game_OnLevelStart",e[e.Game_OnLevelComplate=1001]="Game_OnLevelComplate",e[e.Game_Resurgence=10005]="Game_Resurgence",e[e.AD_WudianBanner_LoadComplete=2217]="AD_WudianBanner_LoadComplete",e[e.AD_WudianBanner_Show=2218]="AD_WudianBanner_Show",e[e.AD_WudianBanner_Hide=2219]="AD_WudianBanner_Hide",e[e.AD_WudianBanner_PreLoad=2220]="AD_WudianBanner_PreLoad",e[e.Game_FOCUS=2001]="Game_FOCUS",e[e.Game_BLUR=2002]="Game_BLUR",e[e.Game_SongSourceChange=10001]="Game_SongSourceChange",e[e.Game_StateChange=10002]="Game_StateChange",e[e.Game_Failure=10003]="Game_Failure",e[e.Game_Settle=10004]="Game_Settle",e[e.RewardVideoSuccess=20010]="RewardVideoSuccess",e[e.RewardVideoFail=20011]="RewardVideoFail",e[e.InsertVideoEnd=20012]="InsertVideoEnd"}(a=n.EventDef||(n.EventDef={}))},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=laya.events.EventDispatcher,o=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dispatch=function(e,n){t.eventDispatcher.event(e,n)},t.prototype.regEvemt=function(e,n,a,o){t.eventDispatcher.on(e,n,a,null==o?null:[o])},t.prototype.regOnceEvent=function(e,n,a,o){t.eventDispatcher.once(e,n,a,null==o?null:[o])},t.prototype.removeEvent=function(e,n,a,o){t.eventDispatcher.off(e,n,a)},t.eventDispatcher=new a,t.instance=new t,t}(a);n["default"]=o},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Mgr/GameMgr"),o=e("./View/ButtonAnim"),i=e("./ShareAd/View/LoopAdBox"),r=e("./ShareAd/View/LoopAdView"),s=e("./View/Game/ExportView"),l=e("./View/Game/GameFailureView"),u=e("./View/TextureProcessBar"),c=e("./View/Game/GameLoadingView"),h=e("./View/Game/CellView/SongDisCell"),d=e("./View/Game/CenterList"),f=e("./View/Game/GameMainView"),p=e("./View/Game/GameSettleView"),g=e("./View/Game/GameWorkView"),y=e("./View/LoadingView/LoadingView"),m=e("./View/Game/CellView/SongStoreCell"),v=e("./View/Game/SongStoreView"),w=e("./View/TipsView/TipsView"),_=e("./ShareAd/View/HorizontalLoopAdView"),S=e("./ShareAd/View/BannerAdView"),L=e("./View/Common/UniversalBottomZone"),C=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("Mgr/GameMgr.ts",a["default"]),e("View/ButtonAnim.ts",o["default"]),e("ShareAd/View/LoopAdBox.ts",i["default"]),e("ShareAd/View/LoopAdView.ts",r["default"]),e("View/Game/ExportView.ts",s["default"]),e("View/Game/GameFailureView.ts",l["default"]),e("View/TextureProcessBar.ts",u["default"]),e("View/Game/GameLoadingView.ts",c["default"]),e("View/Game/CellView/SongDisCell.ts",h["default"]),e("View/Game/CenterList.ts",d["default"]),e("View/Game/GameMainView.ts",f["default"]),e("View/Game/GameSettleView.ts",p["default"]),e("View/Game/GameWorkView.ts",g["default"]),e("View/LoadingView/LoadingView.ts",y["default"]),e("View/Game/CellView/SongStoreCell.ts",m["default"]),e("View/Game/SongStoreView.ts",v["default"]),e("View/TipsView/TipsView.ts",w["default"]),e("ShareAd/View/HorizontalLoopAdView.ts",_["default"]),e("ShareAd/View/BannerAdView.ts",S["default"]),e("View/Common/UniversalBottomZone.ts",L["default"])},e.width=1080,e.height=1920,e.scaleMode="fixedwidth",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="GameMain.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!1,e}();n["default"]=C,C.init()},{"./Mgr/GameMgr":26,"./ShareAd/View/BannerAdView":36,"./ShareAd/View/HorizontalLoopAdView":37,"./ShareAd/View/LoopAdBox":38,"./ShareAd/View/LoopAdView":39,"./View/ButtonAnim":42,"./View/Common/UniversalBottomZone":43,"./View/Game/CellView/SongDisCell":44,"./View/Game/CellView/SongStoreCell":45,"./View/Game/CenterList":46,"./View/Game/ExportView":47,"./View/Game/GameFailureView":48,"./View/Game/GameLoadingView":49,"./View/Game/GameMainView":50,"./View/Game/GameSettleView":51,"./View/Game/GameWorkView":52,"./View/Game/SongStoreView":53,"./View/LoadingView/LoadingView":54,"./View/TextureProcessBar":55,"./View/TipsView/TipsView":56}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){this.bands=new Array,this.bandHighestBuffer=new Array}return Object.defineProperty(e,"Instance",{get:function(){return this._instance?this._instance:this._instance=new e},enumerable:!0,configurable:!0}),e.prototype.Load=function(e,t,n){function a(){var n=Laya.loader.getRes(e);return null==n?void o():(i(),this.LoadJson(n),void(null!=t&&t.run()))}function o(){i(),null!=n&&n.runWith("音频读取失败")}function i(){Laya.loader.off(Laya.Event.ERROR,this,o)}this.bands=new Array,Laya.loader.load(e,Laya.Handler.create(this,a),null,Laya.Loader.JSON),Laya.loader.on(Laya.Event.ERROR,this,o)},e.prototype.LoadJson=function(e){for(var t=e.bands,n=0;n<t.length-1;n++){var a=new o,i=t[n],r=i.split("|");a.timeAppear=parseFloat(r[0]),r=r[1].split(",");for(var s=0;s<r.length;s++){var l=parseFloat(r[s])/1e4;a.buffer.push(l)}this.bands.push(a)}var u=t[t.length-1],c=u.split("|");c=c[1].split(",");for(var n=0;n<c.length;n++)this.bandHighestBuffer.push(parseFloat(c[n])/1e4)},e.prototype.getBandChange=function(e,t){var n=this.bands[t],a=n.buffer[e]/this.bandHighestBuffer[e];return a},e}();n["default"]=a;var o=function(){function e(){this.timeAppear=0,this.buffer=new Array}return e}()},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){this.loadHander=null,this.errorHander=null,this._sound=null,this._soundChannel=null,this._playPosition=0,this._startPlayTime=0}return Object.defineProperty(e,"Instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SoundChannel",{get:function(){return this._soundChannel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsStoped",{get:function(){return this._soundChannel.isStopped},enumerable:!0,configurable:!0}),e.prototype.Load=function(e,t,n){function a(){i(),null!=n&&n.runWith("音乐加载失败")}function o(){i(),null!=t&&(t.run(),this.ClearHander())}function i(){r.off(Laya.Event.COMPLETE,this,o),r.off(Laya.Event.ERROR,this,a)}if(null!=this._soundChannel&&this._soundChannel.url==e)return void(null!=t&&t.run());this.url=e,this.ClearHander(),this.loadHander=t,this.errorHander=n;var r=null,s=Laya.SoundManager._soundClass;Laya.Browser.onMiniGame||(r=Laya.loader.getRes(e)),null!=r?(this._sound=r,o.call(this)):null!=s&&(r=new s,this._sound=r,r.on(Laya.Event.COMPLETE,this,o),r.on(Laya.Event.ERROR,this,a),r.load(e))},e.prototype.LoadPlay=function(e,t,n){var a=this;void 0===t&&(t=0),void 0===n&&(n=1),this.SoomthStop(.5),this.Load(e,Laya.Handler.create(this,function(){a.Play(0),a.ClearHander()}))},e.prototype.Play=function(e){void 0===e&&(e=1),this.CheckState()&&(null!=this._soundChannel&&(this._soundChannel.isStopped||this._soundChannel.pause(),Laya.Tween.clearAll(this.SoundChannel)),null==this._soundChannel||this._soundChannel.url!=this.url?this._soundChannel=this._sound.play(0,e):(this._soundChannel.isStopped||this._soundChannel.pause(),this._soundChannel.volume=1,this._soundChannel.startTime=0,this._soundChannel.loops=e,this._soundChannel.play()),this._playPosition=0,this._startPlayTime=(new Date).getTime(),Laya.SoundManager._bgMusic=this._soundChannel.url)},e.prototype.PlayFromTime=function(e,t){void 0===t&&(t=1),this.CheckState()&&(null!=this._soundChannel&&(this._soundChannel.isStopped||this._soundChannel.pause(),Laya.Tween.clearAll(this.SoundChannel)),null==this._soundChannel||this._soundChannel.url!=this.url?this._soundChannel=this._sound.play(e,t):(this._soundChannel.isStopped||this._soundChannel.pause(),this._soundChannel.volume=1,this._soundChannel.startTime=e,this._soundChannel.loops=t,this._soundChannel.play()),this._playPosition=e,this._startPlayTime=(new Date).getTime(),Laya.SoundManager._bgMusic=this._soundChannel.url)},e.prototype.Stop=function(){null==this.SoundChannel||this.IsStoped||(this._soundChannel.isStopped||this._soundChannel.pause(),Laya.SoundManager._bgMusic="")},e.prototype.SoomthStop=function(e){var t=this;null==this.SoundChannel||this.IsStoped||(Laya.Tween.clearAll(this.SoundChannel),Laya.Tween.to(this.SoundChannel,{volume:.1},1e3*e,Laya.Ease.linearNone,Laya.Handler.create(this,function(){t.IsStoped||t._soundChannel.pause(),Laya.SoundManager._bgMusic=""})))},e.prototype.Pause=function(){null!=this.SoundChannel&&(this._playPosition=this.PlayPosition,this._soundChannel.isStopped||this._soundChannel.pause())},e.prototype.Resume=function(){null!=this.SoundChannel&&(this.SoundChannel.resume(),this._startPlayTime=(new Date).getTime())},Object.defineProperty(e.prototype,"PlayPosition",{get:function(){if(this.IsStoped)return this._playPosition;if(Laya.Browser.onMiniGame){var e=(new Date).getTime()-this._startPlayTime;return this._playPosition+.001*e}var t=(new Date).getTime()-this._startPlayTime;return this._playPosition+.001*t},enumerable:!0,configurable:!0}),e.prototype.Clear=function(){this.Stop(),null!=this._sound&&(this._sound.dispose(),this._sound=null),null!=this._soundChannel&&(this._soundChannel.stop(),this._soundChannel=null),Laya.SoundManager._bgMusic="",Laya.loader.clearRes(this.url)},e.prototype.ClearHander=function(){(null!=this.loadHander||this.loadHander)&&(this.loadHander.clear(),this.loadHander.recover(),this.loadHander=null),(null!=this.errorHander||this.errorHander)&&(this.errorHander.clear(),this.errorHander.recover(),this.errorHander=null)},e.prototype.CheckState=function(){return null==this._sound?(console.log("请先调用Load完成completed后 调用Play 进行播放"),!1):!0},e}();n["default"]=a},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./AudioBand"),o=e("./AudioWraper"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currIndex=0,t.endIndex=0,t}return __extends(t,e),t.prototype.Start=function(){if(!(a["default"].Instance.bands.length<50)){this.currIndex=0,this.endIndex=a["default"].Instance.bands.length-1;var e=a["default"].Instance.bands[this.currIndex],t=a["default"].Instance.bands[this.currIndex+1];Laya.timer.frameLoop(1,this,this.Update),this.onBandChange(e.timeAppear,t.timeAppear,t.buffer[this.bandIndex])}},t.prototype.Stop=function(){this.onBandEnd(),Laya.timer.clearAll(this)},t.prototype.Update=function(){if(null!=o["default"].Instance.SoundChannel&&!o["default"].Instance.IsStoped){var e=o["default"].Instance.PlayPosition,t=a["default"].Instance.bands[this.currIndex],n=a["default"].Instance.bands[this.currIndex+1];if(e>n.timeAppear){if(this.currIndex+=2,this.currIndex>=this.endIndex)return void this.Stop();t=a["default"].Instance.bands[this.currIndex],n=a["default"].Instance.bands[this.currIndex+1],this.onBandChange(t.timeAppear,n.timeAppear,a["default"].Instance.getBandChange(this.bandIndex,this.currIndex))}}},t.prototype.onBandChange=function(e,t,n){},t.prototype.onBandEnd=function(){},t.prototype.Lerp=function(e,t,n){return e+n*(t-e)},t}(Laya.Script3D);n["default"]=i},{"./AudioBand":7,"./AudioWraper":8}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./BandBehavior"),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.startScaleY=0,t.maxScaleY=7,t}return __extends(t,e),Object.defineProperty(t.prototype,"gameObject",{get:function(){return this.owner},enumerable:!0,configurable:!0}),t.prototype.onBandChange=function(e,t,n){Laya.Tween.clearAll(this);var a=(this.gameObject.transform.localScale,n*this.maxScaleY+this.startScaleY),o=1e3*(t-e);Laya.Tween.to(this.gameObject.transform,{localScaleY:a},o)},t.prototype.onBandEnd=function(){Laya.Tween.clearAll(this),Laya.Tween.to(this.gameObject.transform,{localScaleY:this.startScaleY},1e3)},t}(a["default"]);n["default"]=o},{"./BandBehavior":9}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./NoteBoard"),i=e("./GameController"),r=e("./Tools/PhysicTrigger3d"),s=e("./Tools/FSMStateMachine"),l=e("./MouseMgr"),u=e("./NoteManager"),c=e("./GameConst"),h=e("./Audio/AudioWraper"),d="Stand",f="Run",p="RunEnd",g="Die";!function(e){e[e.Red=0]="Red",e[e.Yellow=1]="Yellow",e[e.Blue=2]="Blue"}(a=n.BallColor||(n.BallColor={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.curColor=a.Red,t.mouseDownPosition=new Laya.Vector3,t.songDelay=0,t.currentTime=0,t.curNodeIndex=0,t.endNodeIndex=0,t.dieNodeIndex=0,t.waySpace=0,t.wayTotal=0,t.wayTotalTime=0,t.stateMachine=null,t.upV=0,t.downG=0,t.jumpHeight=4.5,t.lowerHeightFactor=.4,t.higherHeightFactor=.7,t.jumpSpeed=4,t.beatDuration=1,t.ballWillBounce=!1,t.jumpFixedHeight=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"gameObject",{get:function(){return this.owner},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRun",{get:function(){return this.stateMachine.curState.key==f},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RunBeatIndex",{get:function(){return this.curNodeIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"finishProgress",{get:function(){return Math.min(1,this.curNodeIndex/this.endNodeIndex)},enumerable:!0,configurable:!0}),t.prototype.onAwake=function(){this.ball=this.gameObject.getChildByName("Ball"),this.originalPos=this.gameObject.transform.position.clone(),this.originalScale=this.ball.transform.localScale.clone(),r["default"].GetTrigger(this.ball).OnTriggerEnter(this,this.onBallTriggerEnter);var e=this.ball;this.meshRenderer=e._render,this.stateMachine=new s["default"],this.stateMachine.AddAction(d),this.stateMachine.AddAction(f,Laya.Handler.create(this,this.OnSongRun),Laya.Handler.create(this,this.OnSongRunExit)),this.stateMachine.AddAction(p,Laya.Handler.create(this,this.OnRunEndBoard)),this.stateMachine.AddAction(g,Laya.Handler.create(this,this.OnDeath));var t=this.ball.getComponent(Laya.Rigidbody3D);t.ccdSweptSphereRadius=3,t.ccdMotionThreshold=.001;var n=this.ball.getChildByName("TUOWEI");this.trailMaterial=n.trailRenderer.material},t.prototype.Start=function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=a.Red),this.stateMachine.curState.key!=f&&(this.RestPosition(),this.ClearSyncAudioTime(),this.ballWillBounce=!1,this.songDelay=e,this.ChangeColor(n),this.SetRunPosition(t),this.Run())},t.prototype.Run=function(){this.stateMachine.Switch(f)},t.prototype.OnSongRun=function(){this.mouseDownPosition=this.ball.transform.localPosition.clone(),Laya.timer.frameLoop(1,this,this.TimeDelayLogic),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.OnMouseUp),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDown)},t.prototype.OnSongRunExit=function(){Laya.timer.clear(this,this.TimeDelayLogic),Laya.timer.clear(this,this.SongPlayLogic),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDown),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.OnMouseUp)},t.prototype.TimeDelayLogic=function(){return this.currentTime<this.songDelay?(this.currentTime+=Laya.timer.delta/1e3,void this.Refresh(this.currentTime)):(Laya.timer.clear(this,this.TimeDelayLogic),this.lAudioTime=h["default"].Instance.PlayPosition+this.songDelay,this.rTime=this.currentTime,this.pTime=this.currentTime,void Laya.timer.frameLoop(1,this,this.SongPlayLogic,[this.rTime,this.pTime,this.lAudioTime]))},t.prototype.SongPlayLogic=function(){this.curNodeIndex<this.endNodeIndex&&(this.Refresh(this.currentTime),this.stateMachine.curState.key==f&&this.SyncAudioTime(.2))},t.prototype.SyncAudioTime=function(e){void 0===e&&(e=.2);var t=Laya.timer.delta/1e3;if(this.rTime+=t,this.syncCounter>0)this.syncCounter--,this.pTime+=t;else{if(i["default"].Instance.SoundInPause)return this.pTime=i["default"].Instance.soundPauseTime,this.rTime=this.pTime,void(this.currentTime=this.rTime);if(h["default"].Instance.IsStoped)this.pTime=this.rTime;else{var n=h["default"].Instance.PlayPosition;if(Math.abs(this.lAudioTime-n)<.01)this.pTime+=t;else{var a=1;this.syncCounter=a,this.pTime=n+this.songDelay}}}this.currentTime=this.Lerp(this.rTime,this.pTime,e),this.rTime=this.currentTime,this.lAudioTime=this.pTime},t.prototype.ClearSyncAudioTime=function(){this.syncCounter=0,this.currentTime=0,this.lAudioTime=this.rTime=this.pTime=0},t.prototype.Refresh=function(e){var t=u["default"].Instance.GetBeat(this.curNodeIndex),n=u["default"].Instance.GetBeat(this.curNodeIndex+1);if(e>n.timeAppear&&1==this.ballWillBounce){if(this.curNodeIndex++,this.ballWillBounce=!1,this.curNodeIndex>=this.endNodeIndex)return void this.stateMachine.Switch(p);e=n.timeAppear;u["default"].Instance.songNote.beats;return t=u["default"].Instance.GetBeat(this.curNodeIndex),n=u["default"].Instance.GetBeat(this.curNodeIndex+1),void this.SetBallMovement(t,n)}this.UpdatePosition(t.timeAppear,e)},t.prototype.SetJumpForce=function(e,t){var n=(t-e)/2;if(this.jumpFixedHeight){var a=0,o=n/this.beatDuration;a=1>o?this.jumpHeight*(1-(1-o)*this.lowerHeightFactor):this.jumpHeight*(1+(o-1)*this.higherHeightFactor),this.downG=-2*a/(n*n),this.upV=-this.downG*n}else this.upV=this.jumpSpeed,this.downG=-this.upV/n},t.prototype.SetMoveSpace=function(e,t){try{var n=i["default"].Instance.boardManager.GetNoteBoardbyBeat(e),a=i["default"].Instance.boardManager.GetNoteBoardbyBeat(t);this.wayTotalTime=t.timeAppear-e.timeAppear;var o=this.waySpace,r=a.gameObject.transform.position.z-n.gameObject.transform.position.z;this.waySpace=r,this.wayTotal+=o}catch(s){}var l=this.gameObject.transform.position.clone();l.setValue(l.x,l.y,this.wayTotal),this.gameObject.transform.position=l},t.prototype.SetBallMovement=function(e,t){this.SetMoveSpace(e,t),this.SetJumpForce(e.timeAppear,t.timeAppear)},t.prototype.UpdatePosition=function(e,t){var n=t-e;if(0>n)console.log("something wrong: "+t+" < "+e+" : audioTime="+h["default"].Instance.PlayPosition+" : cNoteTime="+u["default"].Instance.songNote.beats[this.curNodeIndex].timeAppear);else{if(l["default"].Instance.isDown){var a=c["default"].BoardInterval,o=this.mouseDownPosition.x+-l["default"].Instance.GetMouseOffsetBySize(.03,!1,!0,!0).x;this.ball.transform.localPositionX=this.Lerp(this.ball.transform.localPositionX-this.originalPos.x,Math.max(-a,Math.min(a,o)),1/60*20)}var i=.7,r=(this.upV+this.downG*n/2)*n,s=this.waySpace*(n/this.wayTotalTime);if(this.ball.transform.localPositionY=this.Lerp(this.ball.transform.localPositionY,r,i),this.gameObject.transform.localPositionZ=this.Lerp(this.gameObject.transform.localPositionZ,this.wayTotal+s,i),this.ball.transform.position.y<-3)return void this.Death(!0)}},t.prototype.Lerp=function(e,t,n){return e+n*(t-e)},t.prototype.OnRunEndBoard=function(){this.PlayBombEffect(),i["default"].Instance.GameEnd()},t.prototype.ActiveStand=function(e){this.stateMachine.Switch(e?d:f)},t.prototype.Death=function(e){this.stateMachine.curState.key!=g&&this.stateMachine.Switch(g,e)},t.prototype.OnDeath=function(e){this.dieNodeIndex=this.curNodeIndex,e?this.ball.transform.localPositionY=-100:this.PlayBombEffect(),i["default"].Instance.GameFailure()},t.prototype.Resurrection=function(){var e=this.dieNodeIndex;return e+=1,e>=this.endNodeIndex?void this.stateMachine.Switch(p):void this.SetRunPosition(e)},t.prototype.SetRunPosition=function(e){var t=u["default"].Instance.songNote.beats;this.curNodeIndex=e,this.endNodeIndex=t.length-1;var n=t[e],a=t[e+1];this.currentTime=n.timeAppear,this.SetBallMovement(n,a),this.UpdatePosition(n.timeAppear,n.timeAppear);var o=i["default"].Instance.boardManager.GetNoteBoardbyBeat(n),r=o.GetNoteColorPosition(n,this.curColor);r.setValue(r.x,this.originalPos.y,r.z),this.ball.transform.localPosition=r.clone(),this.ball.transform.localScale=this.originalScale.clone()},t.prototype.ChangeColor=function(e){var t=new Laya.Vector4,n=i["default"].Instance.GetColorMaterial(e,t);null!=n&&(this.meshRenderer.material=i["default"].Instance.GetColorMaterial(e,t),this.curColor=e,this.trailMaterial.color=t)},t.prototype.Reset=function(){this.RestPosition(),this.ClearSyncAudioTime()},t.prototype.RestPosition=function(){this.waySpace=0,this.wayTotal=0,this.wayTotalTime=0,this.ball.transform.localScale=this.originalScale.clone(),this.ball.transform.localPosition=this.originalPos.clone(),this.gameObject.transform.position=new Laya.Vector3(this.originalPos.x,0,this.originalPos.z)},t.prototype.onBallTriggerEnter=function(e,t){this.KnockNote(t.owner)},t.prototype.CheckBallTrigger=function(){},t.prototype.KnockNote=function(e){if("DieBox"==e.name)return void this.Death(!0);var t=e.parent.parent.getComponent(o["default"]);t&&(t.CheckTirgger(this,e),this.ballWillBounce=!0),i["default"].Instance.boardManager.KnockNote()},t.prototype.PlayBombEffect=function(){var e=this.gameObject.getChildByName("DeathEffect");e.active=!0,e.transform.localPosition=this.ball.transform.localPosition.clone(),this.ball.transform.localScale=new Laya.Vector3(.001,.001,.001),Laya.timer.once(1500,this,function(){e.active=!1})},t.prototype.onUpdate=function(){this.stateMachine.Update()},t.prototype.OffsetPercent=function(){return this.ball.transform.localPositionX/c["default"].BoardInterval},t.prototype.OnMouseDown=function(){this.mouseDownPosition=this.ball.transform.localPosition.clone()},t.prototype.OnMouseUp=function(){this.mouseDownPosition=new Laya.Vector3},t}(Laya.Script3D);n["default"]=y},{"./Audio/AudioWraper":8,"./GameConst":13,"./GameController":14,"./MouseMgr":15,"./NoteBoard":16,"./NoteManager":18,"./Tools/FSMStateMachine":21,"./Tools/PhysicTrigger3d":22}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxOffset=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"gameObject",{get:function(){return this.owner},enumerable:!0,configurable:!0}),t.prototype.onAwake=function(){this.camera=this.owner.getChildByName("Camera")},t.prototype.SetTaget=function(e){this.targetBall=e,this.offsetPosition=new Laya.Vector3,Laya.Vector3.subtract(this.gameObject.transform.position,this.targetBall.gameObject.transform.position,this.offsetPosition)},t.prototype.onLateUpdate=function(){if(null!=this.targetBall){var e=new Laya.Vector3;Laya.Vector3.add(this.targetBall.gameObject.transform.position,this.offsetPosition,e);var t=this.maxOffset*this.targetBall.OffsetPercent();e.setValue(t,e.y,e.z),this.gameObject.transform.position=e.clone()}},t}(Laya.Script3D);n["default"]=a},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../AppConfig"),o=function(){function e(){}return Object.defineProperty(e,"RemoteRes",{get:function(){return a["default"].ResServer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GetLocalSubResVersionPath",{get:function(){return"subRes"+e.VersionFile+"Version.json"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GetRemoteVersionPath",{get:function(){return e.RemoteRes+e.VersionFile+"Version.json"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GetRandomSongPreviewPng",{get:function(){return"Resource/SongDisc/0.png"},enumerable:!0,configurable:!0}),e.SoundFile="/Sound/",e.SoundPreviewImages="/PreviewImage/",e.VersionFile="/Music/",e.GameScenePath="subRes/Scenes/LayaScene_Game/Conventional/Game.ls",e.BoardInterval=3.75,e.BoardIntervalTime=.2,e.BoardIntervalSpace=3,e}();n["default"]=o},{"../AppConfig":2}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GameConst"),o=e("./Tools/CameraMoveScript"),i=e("./BallController"),r=e("./MouseMgr"),s=e("../Mgr/ViewMgr"),l=e("./NoteBoardManager"),u=e("./NoteManager"),c=e("../Event/EventMgr"),h=e("../Event/EventDef"),d=e("../WXAPI"),f=e("./CameraFollow"),p=e("./SoundManager"),g=e("../Mgr/VibrateMgr"),y=e("../User/User"),m=e("./Audio/AudioBand"),v=e("./Audio/AudioWraper"),w=e("../NativeCallback"),_=function(){function e(){this._inited=!1,this.currentSong=null,this.scene=null,this.boardManager=null,this.ballController=null,this.cameraFollow=null,this.isRun=!1,this.isReady=!1,this.isGameing=!1,this.isLoading=!1,this.realStartTime=0,this.soundPauseTime=0,this.SoundInPause=!1,this.currentSource=0,this.continuousPerfect=0,this.currentPerfectCount=0}return Object.defineProperty(e,"Instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.Init=function(e,t){var n=this;return void 0===e&&(e=null),void 0===t&&(t=null),this._inited?void(null!=t&&t.call(e)):(r["default"].Instance,this.LoadGameScene(a["default"].GameScenePath,this,function(e){n.scene=e;var a=e.getChildByName("PlatformManager");n.boardManager=a.addComponent(l["default"]);var r=e.getChildByName("Main Camera");n.cameraFollow=r.addComponent(f["default"]),r.getChildByName("Camera").addComponent(o["default"]);var s=e.getChildByName("BallController");n.ballController=s.addComponent(i["default"]),n.cameraFollow.SetTaget(n.ballController),null!=t&&t.call(n)}),void Laya.stage.on("visibilitychange",this,this.VisibilityChange))},e.prototype.LoadGameScene=function(e,t,n){Laya.Scene3D.load(e,Laya.Handler.create(this,function(e){Laya.stage.addChild(e),Laya.stage.setChildIndex(e,0),null!=n&&null!=e&&n.call(this,e)}))},e.prototype.RayCast=function(e,t,n){this.scene.physicsSimulation.rayCast(e,t,n)},e.prototype.LoadWaitingTime=function(e){e.run()},e.prototype.Load=function(e,t,n){function a(e){console.error(e),r=!0,i.isLoading=!1,this.ClearGameRes(),Laya.loader.off(Laya.Event.ERROR,this,a),Laya.timer.clear(this,this.LoadWaitingTime),null!=n&&n.recover(),null!=t&&(t.runWith(!1),t.recover())}var o=this;this.isLoading=!0;var i=this,r=!1,s=Laya.Handler.create(this,function(e){r||(1!=e&&null!=n?n.runWith(e):(i.isLoading=!1,s.recover(),Laya.loader.off(Laya.Event.ERROR,o,a),Laya.timer.clear(o,o.LoadWaitingTime),null!=n&&(n.runWith(1),n.recover()),null!=t&&(t.runWith(!0),t.recover())))},null,!1),l=function(){r||(s.runWith(.7),m["default"].Instance.LoadJson(Laya.loader.getRes(e.songBandPath)),u["default"].Instance.LoadJson(Laya.loader.getRes(e.songJosnPath)),o.boardManager.InitNoteBoard(u["default"].Instance.songNote.clone()),v["default"].Instance.Load(e.songPath,Laya.Handler.create(o,function(){r||s.runWith(1)}),Laya.Handler.create(o,a)))},c=[{url:e.songJosnPath,type:Laya.Loader.JSON},{url:e.songBandPath,type:Laya.Loader.JSON}],h=Laya.loader.load(c,Laya.Handler.create(this,function(){Laya.timer.callLater(o,l)}),Laya.Handler.create(this,function(e){s.runWith(.7*e)},null,!1));h.on(Laya.Event.ERROR,this,a),Laya.timer.once(7e3,this,this.LoadWaitingTime,[Laya.Handler.create(this,a,["加载超时"])])},e.prototype.GameReady=function(e,t,n){var a=this;1!=this.isLoading&&(n&&(n.once=!1),this.GameRest(),this.currentSong=e,this.Load(e,Laya.Handler.create(this,function(e){return e?(a.isReady=!0,a.realStartTime=Laya.timer.currTimer,r["default"].Instance.enable=!0,void(null!=t&&t.runWith(e))):(s["default"].instance.closeView(s.ViewDef.GameLoadingView),void s["default"].instance.openView(s.ViewDef.GameMainView,null,function(){s["default"].instance.openView(s.ViewDef.TipsView,"加载音乐失败！")}))}),n))},e.prototype.GamePlay=function(){if(!this.isReady)return void console.error("未完成游戏音乐加载！");this.isGameing=!0,this.isRun=!0,this.isReady=!1;var e=u["default"].Instance.songNote.beats,t=e[0],n=t.notes[0].columnIndex%3;this.ballController.Start(0,0,n),v["default"].Instance.Play(),this.boardManager.BandCubesStart(),this.OnStageStateChange()},e.prototype.GameFailure=function(){this.isRun=!1,v["default"].Instance.Stop(),c["default"].instance.dispatch(h.EventDef.Game_Failure),this.OffStageStateChange()},e.prototype.OpenRewardedVideo=function(e){Laya.Browser.onMiniGame?d["default"].showRewardedVideoAd(function(t){null!=e&&e.runWith(t)},function(){null!=e&&e.runWith(!1)}):null!=e&&e.runWith(!0)},e.prototype.ResurrectionGame=function(){this.ballController.Resurrection(),c["default"].instance.dispatch(h.EventDef.Game_Resurgence)},e.prototype.BallRun=function(){this.isRun=!0,this.OnStageStateChange(),this.ballController.Run();var e=u["default"].Instance.GetBeatTimeAppear(this.ballController.RunBeatIndex);v["default"].Instance.PlayFromTime(e)},e.prototype.GameEnd=function(){this.SettleSongRecord(!0),v["default"].Instance.SoomthStop(1),c["default"].instance.dispatch(h.EventDef.Game_Settle,!0)},Object.defineProperty(e.prototype,"currStartLevel",{get:function(){var e=Math.floor(u["default"].Instance.songNote.beats.length/3),t=Math.min(1,Math.floor(this.currentPerfectCount/e));return t},enumerable:!0,configurable:!0}),e.prototype.GameOver=function(){this.SettleSongRecord(!1),c["default"].instance.dispatch(h.EventDef.Game_Settle,!1)},e.prototype.SettleSongRecord=function(e){this.isRun=!1,this.isGameing=!1;
var t=this.currentSong.name,n=this.currStartLevel;p["default"].Instance.SubPlayOneMoney(this.currentSong),p["default"].Instance.SaveSongRecord(t,n,this.currentSource,e)},e.prototype.GetCurrentSongRecord=function(){var e=this.currentSong,t=new y.PassSong;return t.name=e.name,t.source=this.currentSource,t.starLevel=this.currStartLevel,t},e.prototype.GameRest=function(){this.isReady=!1,this.RestSongSorce(),this.ClearGameRes(),this.OffStageStateChange(),this.ballController.Reset(),this.boardManager.BandCubesStop(),r["default"].Instance.enable=!1},e.prototype.ClearGameRes=function(){this.boardManager.Clear(),v["default"].Instance.Clear(),Laya.loader.clearUnLoaded(),Laya.Resource.destroyUnusedResources(),Laya.SoundManager.stopMusic(),Laya.SoundManager.stopAllSound(),this.currentSong&&(Laya.loader.clearRes(this.currentSong.songPath),Laya.loader.clearRes(this.currentSong.songBandPath),Laya.loader.clearRes(this.currentSong.songJosnPath))},Object.defineProperty(e.prototype,"CurrentRunTime",{get:function(){return(Laya.timer.currTimer-this.realStartTime)/1e3},enumerable:!0,configurable:!0}),e.prototype.PauseGame=function(){this.SoundInPause||(this.SoundInPause=!0,this.soundPauseTime=v["default"].Instance.PlayPosition,v["default"].Instance.Pause(),this.ballController.ActiveStand(!0))},e.prototype.ResumeGame=function(){this.SoundInPause&&(this.SoundInPause=!1,v["default"].Instance.Resume(),this.soundPauseTime=0,this.ballController.ActiveStand(!1))},e.prototype.AddSongSource=function(e,t){var n=58,a=100;this.ballController.isRun&&(e?(this.continuousPerfect++,this.currentPerfectCount++,this.currentSource+=a,g["default"].vibrateShort()):(this.continuousPerfect=0,this.currentSource+=n,g["default"].ibrateLong()),c["default"].instance.dispatch(h.EventDef.Game_SongSourceChange,[this.currentSource,t,this.continuousPerfect]))},e.prototype.RestSongSorce=function(){this.currentSource=0,this.continuousPerfect=0,this.currentPerfectCount=0},e.prototype.GetColorMaterial=function(e,t){var n="";switch(t=t?t:new Laya.Vector4,e){case i.BallColor.Red:n="Red.lmat",t.setValue(1,24/255,24/255,.5);break;case i.BallColor.Blue:n="Blue.lmat",t.setValue(28/255,95/255,1,.5);break;case i.BallColor.Yellow:n="Yellow.lmat",t.setValue(1,239/255,28/255,.5)}var a=Laya.loader.getRes("subRes/Scenes/LayaScene_Game/Conventional/Assets/Material/"+n);return null==a?null:a},e.prototype.OnStageStateChange=function(){c["default"].instance.regEvemt(h.EventDef.Game_BLUR,this,this.StageOnBlur),c["default"].instance.regEvemt(h.EventDef.Game_FOCUS,this,this.StageOnFocus)},e.prototype.OffStageStateChange=function(){c["default"].instance.removeEvent(h.EventDef.Game_BLUR,this,this.StageOnBlur),c["default"].instance.removeEvent(h.EventDef.Game_FOCUS,this,this.StageOnFocus)},e.prototype.VisibilityChange=function(){w["default"].ShowLog("VisibilityChange ------ "+Laya.stage.isVisibility),Laya.stage.isVisibility?this.StageOnFocus():this.StageOnBlur()},e.prototype.StageOnBlur=function(){w["default"].ShowLog("StageOnBlur========"),this.SoundInPause||c["default"].instance.dispatch(h.EventDef.Game_StateChange,!1)},e.prototype.StageOnFocus=function(){w["default"].ShowLog("StageOnFocus======="),this.SoundInPause&&c["default"].instance.dispatch(h.EventDef.Game_StateChange,!0)},e}();n["default"]=_},{"../Event/EventDef":4,"../Event/EventMgr":5,"../Mgr/VibrateMgr":28,"../Mgr/ViewMgr":29,"../NativeCallback":30,"../User/User":40,"../WXAPI":58,"./Audio/AudioBand":7,"./Audio/AudioWraper":8,"./BallController":11,"./CameraFollow":12,"./GameConst":13,"./MouseMgr":15,"./NoteBoardManager":17,"./NoteManager":18,"./SoundManager":19,"./Tools/CameraMoveScript":20}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){this.enable=!1,this.isDown=!1,this.isMoving=!1,this.mouseDownPoint=new Laya.Vector3(0,0,0),this.mouseMoveOffset=new Laya.Vector3(0,0,0),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.OnMoseUp),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.OnMoseUp)}return Object.defineProperty(e,"Instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.OnMouseDown=function(e){this.enable&&(this.isDown=!0,this.mouseMoveOffset=new Laya.Vector3(0,0,0),this.mouseDownPoint=new Laya.Vector3(e.stageX,e.stageY,0),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.OnMouseMove))},e.prototype.OnMouseMove=function(e){this.isMoving=!0,this.mouseMoveOffset=new Laya.Vector3(0,0,0),Laya.Vector3.subtract(new Laya.Vector3(e.stageX,e.stageY,0),this.mouseDownPoint,this.mouseMoveOffset)},e.prototype.OnMoseUp=function(){this.isDown=!1,this.isMoving=!1,this.ResetMouseOffset(),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.OnMouseMove)},e.prototype.ResetMouseOffset=function(){this.isDown=!1,this.isMoving=!1,this.mouseDownPoint=new Laya.Vector3(Laya.stage.mouseX,Laya.stage.mouseY,0),this.mouseMoveOffset=new Laya.Vector3(0,0,0)},e.prototype.GetMouseOffsetBySize=function(e,t,n,a){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===a&&(a=!1);var o=new Laya.Vector3(0,0,0);return Laya.Vector3.scale(this.mouseMoveOffset,e,o),t&&(o.x=0),n&&(o.y=0),a&&(o.z=0),o},e}();n["default"]=a},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./BallController"),o=e("./GameConst"),i=e("../Utilit"),r=e("./GameController"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"gameObject",{get:function(){return this.owner},enumerable:!0,configurable:!0}),t.prototype.onAwake=function(){if(this.IsBigBoard="BigNoteBoard"==this.owner.name,this.boards=i["default"].FindChild(this.owner,"Boards"),this.animator=this.boards.getComponent(Laya.Animator),this.crashEffect=i["default"].FindChild(this.owner,"Effect/crashEffect"),this.IsBigBoard){var e=i["default"].FindChild(this.boards,"Box/Box002_0");this.meshRenderer=e._render}else this.perfectEffect=i["default"].FindChild(this.owner,"Effect/perfectCrashEffect")},t.prototype.TweenAnimtion=function(e){this.gameObject.transform.localScaleX=1e-4,this.gameObject.transform.localPositionY=0,Laya.Tween.to(this.gameObject.transform,{localScaleX:1},300,Laya.Ease.backOut,null,1e3*e),Laya.Tween.to(this.gameObject.transform,{localPositionY:0},300,Laya.Ease.backOut,null,1e3*e)},t.prototype.ResetBoard=function(e,t,n){if(this.IsBigBoard){this.color=e.notes[0].columnIndex%3;var a=r["default"].Instance.GetColorMaterial(this.color,null);this.meshRenderer.material=a}else{var i=e.notes[0].columnIndex%3,s=this.boards.getChildByName("Red"),l=this.boards.getChildByName("Yellow"),u=this.boards.getChildByName("Blue");this.boards.setChildIndex(s,i++),this.boards.setChildIndex(l,i++%3),this.boards.setChildIndex(u,i++%3);for(var c=new Laya.Vector3(o["default"].BoardInterval,0,0),h=0;h<this.boards._children.length;h++){var d=this.boards.getChildAt(h);d.transform.localPosition=c,c.setValue(c.x-o["default"].BoardInterval,0,0),null!=n?d.active=this.GetColorByString(d.name)==n:d.active=!0}}this.beat=e,this.owner.transform.position=t},t.prototype.GetNoteColorPosition=function(e,t){var n=new Laya.Vector3;if(!this.IsBigBoard){var a=e.notes[0].columnIndex%3,i=(t+a)%3;n=new Laya.Vector3(o["default"].BoardInterval-i*o["default"].BoardInterval,0,0)}return n},t.prototype.CheckTirgger=function(e,t){this.IsBigBoard?this.TirggerBigBoard(e,t):this.TirggerSmallBoard(e,t)},t.prototype.TirggerBigBoard=function(e,t){var n=this.color;e.ChangeColor(n),this.ActiveCrashEffect(this.gameObject.transform.position.clone()),r["default"].Instance.AddSongSource(!0,e.finishProgress)},t.prototype.TirggerSmallBoard=function(e,t){if(null!=e&&null!=t){var n=e.curColor,a=this.GetColorByString(t.name);if(n!=a)return void e.Death(!1);var o=.5,i=Math.abs(t.transform.position.x-e.ball.transform.position.x)<o;r["default"].Instance.AddSongSource(i,e.finishProgress),this.ActiveCrashEffect(t.transform.position.clone()),i&&this.ActivePerfectEffect(t.transform.position.clone())}},t.prototype.ActiveCrashEffect=function(e){var t=this;this.crashEffect.active=!0,e.setValue(e.x,e.y+.1,e.z),this.crashEffect.transform.position=e,this.animator.play("Shank"),Laya.timer.once(1e3,this,function(){t.animator.play("Def"),t.crashEffect.active=!1})},t.prototype.ActivePerfectEffect=function(e){var t=this;this.perfectEffect.active=!0,e.setValue(e.x,e.y+.1,e.z),this.perfectEffect.transform.position=e,Laya.timer.once(1e3,this,function(){t.perfectEffect.active=!1})},t.prototype.GetColorByString=function(e){var t=a.BallColor.Red;switch(e){case"Red":t=a.BallColor.Red;break;case"Blue":t=a.BallColor.Blue;break;case"Yellow":t=a.BallColor.Yellow}return t},t.GetBigBoardColor=function(e){return e.notes[0].columnIndex%3},t}(Laya.Script3D);n["default"]=s},{"../Utilit":41,"./BallController":11,"./GameConst":13,"./GameController":14}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GameController"),o=e("./NoteBoard"),i=e("./GameConst"),r=e("./BallController"),s=e("./Audio/ParamCubeCube"),l=e("./Audio/AudioWraper"),u="CrashEffect",c="CrashEffect",h="SmallNoteBoard",d="BigNoteBoard",f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._songNote=null,t._lastAppearBeat=null,t._noteBoards=null,t._pastNoteBoards=null,t.PreLoadNoteTime=20,t._bandCubes=new Array,t._correctColor=r.BallColor.Red,t._crashPrefab=null,t._perfectCrashPrefab=null,t._bigNoteBoardPrefab=null,t._smallNoteBoardPrefab=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"gameObject",{get:function(){return this.owner},enumerable:!0,configurable:!0}),t.prototype.onAwake=function(){var e=a["default"].Instance.scene.getChildByName("Prefabs");this._crashPrefab=e.getChildByName("crashEffect"),this._perfectCrashPrefab=e.getChildByName("perfectCrashEffect"),this._bigNoteBoardPrefab=e.getChildByName("BigNoteBoard"),this._smallNoteBoardPrefab=e.getChildByName("SmallNoteBoard"),this.InitBandEffect()},t.prototype.InitBandEffect=function(){for(var e=this.gameObject.getChildByName("Effect"),t=0;2>t;t++)for(var n=e.getChildByName("BandCubes"+t),a=0;8>a;a++){var o=n.getChildByName("BandCube"+a);if(0!=o.active){var i=o.addComponent(s["default"]);i.bandIndex=a,this._bandCubes.push(i)}}},t.prototype.InitNoteBoard=function(e){this.Clear(),this._songNote=e,this.AutoSpawnNewNoteBoard(0)},t.prototype.AutoSpawnNewNoteBoard=function(e){for(var t=0,n=.1,a=e+this.PreLoadNoteTime,o=this._songNote.beats,i=0;i<o.length;i++){var r=o[i],s=r.timeAppear;if(s>a||this._noteBoards.length>7)break;if(!(null!=this._lastAppearBeat&&this._lastAppearBeat.timeAppear>=r.timeAppear)){var l=this.SpawnNewNoteBoard(r,t++*n);this._noteBoards.push(l),this._lastAppearBeat=r}}},t.prototype.SpawnNewNoteBoard=function(e,t){var n=new Laya.Vector3(0,0,0);if(null!=this._lastAppearBeat){var r=this._noteBoards[this._noteBoards.length-1],s=e.timeAppear-this._lastAppearBeat.timeAppear;if(s>=i["default"].BoardIntervalTime){var l=s*(i["default"].BoardIntervalSpace/i["default"].BoardIntervalTime);n.setValue(0,0,r.gameObject.transform.position.z+l)}else n.setValue(0,0,r.gameObject.transform.position.z+i["default"].BoardIntervalSpace)}var u=e.notes.length>=2;u&&(this._correctColor=o["default"].GetBigBoardColor(e));var c=u?d:h,f=this.AutoSpawnPrefab(c),p=f.getComponent(o["default"]);null==p&&(p=f.addComponent(o["default"]));var g=a["default"].Instance.currentSong.showOneColor;return p.ResetBoard(e,n,g?this._correctColor:null),p.TweenAnimtion(t),p},t.prototype.AutoRecycleNoteBoard=function(){for(var e=10,t=0;t<this._noteBoards.length;){var n=this._noteBoards[t],o=a["default"].Instance.ballController.gameObject.transform.position.z-n.gameObject.transform.position.z;e/2>o?t++:(this._noteBoards.splice(t,1),this._pastNoteBoards.push(n))}for(var t=0;t<this._pastNoteBoards.length;){var n=this._pastNoteBoards[t],o=a["default"].Instance.ballController.gameObject.transform.position.z-n.gameObject.transform.position.z;e>o?t++:(this._pastNoteBoards.splice(t,1),this.RecycleNoteBoard(n))}},t.prototype.RecycleNoteBoard=function(e){e.gameObject.transform.localPositionY=-100;var t=e.IsBigBoard?d:h;this.RecyclePrefab(t,e.gameObject)},t.prototype.Clear=function(){if(null!=this._noteBoards)for(var e=0;e<this._noteBoards.length;){var t=this._noteBoards[e];this._noteBoards.splice(0,1),this.RecycleNoteBoard(t)}if(null!=this._pastNoteBoards)for(var e=0;e<this._pastNoteBoards.length;){var t=this._pastNoteBoards[e];this._pastNoteBoards.splice(0,1),this.RecycleNoteBoard(t)}this._correctColor=null,this._lastAppearBeat=null,this._noteBoards=new Array,this._pastNoteBoards=new Array,this.gameObject.transform.position=new Laya.Vector3},t.prototype.GetNoteBoardbyBeat=function(e){for(var t=0;t<this._noteBoards.length;t++){var n=this._noteBoards[t];if(e.guid==n.beat.guid)return n}return null},t.prototype.KnockNote=function(){var e=this.owner.getChildByName("Effect"),t=e.getChildByName("yingbo"),n=70,a=1.03;Laya.Tween.clearAll(t.transform);var o={localScaleX:a,localScaleY:a,localScaleZ:a},i={localScaleX:1,localScaleY:1,localScaleZ:1};Laya.Tween.to(t.transform,o,n,Laya.Ease.quadOut,Laya.Handler.create(this,function(){Laya.Tween.to(t.transform,i,n,Laya.Ease.quadIn)}))},t.prototype.AutoSpawnPrefab=function(e){var t=Laya.Pool.getItem(e);if(null!=t)return t;var n=a["default"].Instance.scene;switch(e){case u:t=Laya.Sprite3D.instantiate(this._crashPrefab,n);break;case c:t=Laya.Sprite3D.instantiate(this._perfectCrashPrefab,n);break;case d:console.log("create big"),t=Laya.Sprite3D.instantiate(this._bigNoteBoardPrefab,n);break;case h:console.log("create small"),t=Laya.Sprite3D.instantiate(this._smallNoteBoardPrefab,n);break;default:throw"没有这个预制体："+e}return t},t.prototype.RecyclePrefab=function(e,t){t.transform.localPositionX=-10,Laya.Pool.recover(e,t)},t.prototype.BandCubesStart=function(){for(var e=0;e<this._bandCubes.length;e++)this._bandCubes[e].Start()},t.prototype.BandCubesStop=function(){for(var e=0;e<this._bandCubes.length;e++)this._bandCubes[e].Stop()},t.prototype.onLateUpdate=function(){if(a["default"].Instance.isRun){this.AutoRecycleNoteBoard(),l["default"].Instance.SoundChannel&&this.AutoSpawnNewNoteBoard(l["default"].Instance.PlayPosition);var e=this.owner.transform;e.position=a["default"].Instance.ballController.gameObject.transform.position.clone()}},t}(Laya.Script3D);n["default"]=f},{"./Audio/AudioWraper":8,"./Audio/ParamCubeCube":10,"./BallController":11,"./GameConst":13,"./GameController":14,"./NoteBoard":16}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){this._songNote=null}return Object.defineProperty(e,"Instance",{get:function(){return this._instance?this._instance:this._instance=new e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"songNote",{get:function(){return this._songNote},enumerable:!0,configurable:!0}),e.prototype.Load=function(e,t,n){var a=this;Laya.loader.load(e,Laya.Handler.create(this,function(){var o=Laya.loader.getRes(e);return null==o?void console.log("访问Song节奏文件资源失败！"+e):(a.LoadJson(Laya.loader.getRes(e)),void(null!=n&&n.call(t)))}),null,Laya.Loader.JSON)},e.prototype.LoadJson=function(e){if(null!=e){var t=e.time,n=e.note;if(0!=n.length){var a=t[0].bpm,i=n[0].beat[2],r=(60/(t[0].bpm*i),n[n.length-1].offset/1e3),s=new o(t[0].bpm,this.AnalyzeTransformNoteTest(n,a),r);s.songName=n[n.length-1].sound,this._songNote=s}}},e.prototype.AnalyzeTransformNote=function(t,n,a){for(var o=null,s=null,l=new Array,u=0;u<t.length-1;u++){var c=t[u],h=c.beat[0],d=h*n+c.beat[1],f=c.column,p=d*a;o!=d&&(s=new Array,o=d,l.push(new i(s,e.guidIndex++))),s.push(new r(f,p))}return l},e.prototype.AnalyzeTransformNoteTest=function(t,n){for(var a=null,o=null,s=new Array,l=0;l<t.length-1;l++){var u=t[l],c=(u.beat,u.column),h=u.beat[0]*u.beat[2]+u.beat[1],d=h*(60/(n*u.beat[2]));a!=d&&(o=new Array,a=d,s.push(new i(o,e.guidIndex++))),o.push(new r(c,d))}return s},e.prototype.GetBeat=function(e){return this.songNote.beats[e]},e.prototype.GetBeatTimeAppear=function(e){return this.songNote.beats[e].timeAppear},e.guidIndex=0,e}();n["default"]=a;var o=function(){function e(e,t,n){void 0===n&&(n=0),this.bpm=0,this.beatDelay=0,this.beats=null,this.songName="",this.beats=t,this.bpm=e,this.beatDelay=null==n?0:n}return e.prototype.clone=function(){for(var t=this.bpm,n=this.beatDelay,a=new Array,o=0;o<this.beats.length;o++)a.push(this.beats[o]);return new e(t,a,n)},e}();n.SongNote=o;var i=function(){function e(e,t){void 0===t&&(t=0),this.guid=0,this.notes=null,this.notes=e,this.guid=t}return Object.defineProperty(e.prototype,"timeAppear",{get:function(){return this.notes[0].timeAppear},enumerable:!0,configurable:!0}),e.prototype.GetColumnGroup=function(e){for(var t=0;t<this.notes.length;t++)if(this.notes[t].columnIndex==e)return this.notes[t];return null},e}();n.Beat=i;var r=function(){function e(e,t){this.noteIndex=0,this.columnIndex=0,this.timeAppear=0,this.columnIndex=e,this.timeAppear=t}return e}();n.Note=r},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Version"),o=e("../User/User"),i=e("../Mgr/ViewMgr"),r=e("../WXAPI"),s=e("../Mgr/GameMgr"),l=e("./Audio/AudioWraper");n.castPlayOneMoney=10;var u="LastPlaySong",c=function(){function e(){}return Object.defineProperty(e,"Instance",{get:function(){return e._instance?e._instance:e._instance=new e},enumerable:!0,configurable:!0}),e.prototype.IsFirstEnterGame=function(){var e="FirstEnter",t=Laya.LocalStorage.getItem(e);return Laya.LocalStorage.setItem(e,"succeed"),null==t||""==t},e.prototype.IsFirstTime=function(){for(var e=0,t=o["default"].getPassSong(),n=0;n<t.length;n++)t[n].completed&&(e+=1);return 1>e},e.prototype.CheckSongUnlocked=function(e){return o["default"].IncludetSong(e)},e.prototype.CanPlayOne=function(){return o["default"].getMoney()<n.castPlayOneMoney?!1:!0},e.prototype.GetSongRecord=function(e){for(var t=o["default"].getPassSong(),n=0;n<t.length;n++){var a=t[n];if(a.name==e)return a}return null},e.prototype.SaveSongRecord=function(e,t,n,a,o){console.log("saveSongRecord:"+e+"|starLevel:"+t+"|source:"+n);var i=this.GetSongRecord(e);n>i.source&&(i.source=n),t>i.starLevel&&(i.starLevel=t),i.completed||(i.completed=a),o?s["default"].getInstance().save_myqq_GameData(o.caller,o.method):s["default"].getInstance().save_myqq_GameData()},e.prototype.GetSongbyName=function(e){for(var t=a["default"].songs,n=0;n<t.length;n++)if(t[n].name==e)return t[n];return null},e.prototype.PlaySongbyName=function(e){var t=this.GetSongbyName(e);this.PlaySong(t)},e.prototype.CheckSongIsFree=function(e){var t=a["default"].enableCharge?0==e.chargeType:!0;return t},e.prototype.AuditionSong=function(e){Laya.LocalStorage.setItem(u,e.name),l["default"].Instance.LoadPlay(e.songPath)},e.prototype.PlaySong=function(e,t,n){function a(a){a&&(l["default"].Instance.Stop(),Laya.LocalStorage.setItem(u,e.name),i["default"].instance.openView(i.ViewDef.GameLoadingView,e,function(){null!=n&&n.call(t)}))}if(null!=e){var o=this.CanPlayOne();this.PlayAndUnlockSong(o,e,Laya.Handler.create(this,a))}},e.prototype.GetSongCastMoney=function(e){return e.chargeType==a.ChargeType.Power?e.costPower:n.castPlayOneMoney},e.prototype.SubPlayOneMoney=function(e,t){void 0===t&&(t=!1);var n=this.GetSongCastMoney(e);o["default"].subMoney(n),1==t&&s["default"].getInstance().save_myqq_GameData()},e.prototype.PlayAndUnlockSong=function(e,t,n){var r=this,l=function(e){return n&&n.runWith(e),e?void(o["default"].IncludetSong(t.name)||(o["default"].AddUnlockSong(t.name),s["default"].getInstance().save_myqq_GameData(r))):void i["default"].instance.showTips("观看完整视频才可解锁游戏！")};if(a["default"].enableCharge){if(o["default"].IncludetSong(t.name))return void(null!=n&&n.runWith(!0));this.PlayCastByChargeType(t.chargeType,t.costPower,this,l)}else e?l.call(this,!0):this.PlayCastByChargeType(2,0,this,l)},e.prototype.LookRewardedVideo=function(e){this.PlayCastByChargeType(3,0,e.caller,e.method)},e.prototype.PlayCastByChargeType=function(e,t,n,i){switch(e){case a.ChargeType.Free:console.log("免费解锁"),i.call(n,!0);break;case a.ChargeType.Power:if(console.log("消耗体力解锁"),o["default"].getMoney()<t)return void i.call(n,!1);o["default"].subMoney(10),i.call(n,!0);break;case a.ChargeType.Video:console.log("广告解锁");r["default"].showRewardedVideoAd(function(e){i.call(n,e)},function(){i.call(n,!1)})}},e.prototype.GetLastPlaySongIndex=function(){for(var e=0,t=Laya.LocalStorage.getItem(u),n=0;n<a["default"].songs.length;n++){var o=a["default"].songs[n];o.name==t&&(e=n)}return e},e.prototype.GetSongAwards=function(e,t){var n=2;return e?n*t:5},e.prototype.SetAdSongAwards=function(e){var t=5*this.GetSongAwards(!0,e);return o["default"].addMoney(t),s["default"].getInstance().save_myqq_GameData(),o["default"].getMoney()},e.prototype.SetFreeSongAwards=function(){var e=this.GetSongAwards(!1,0);return o["default"].addMoney(e),s["default"].getInstance().save_myqq_GameData(),o["default"].getMoney()},e}();n["default"]=c},{"../Mgr/GameMgr":26,"../Mgr/ViewMgr":29,"../User/User":40,"../WXAPI":58,"./Audio/AudioWraper":8,"./Version":23}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t._tempVector3=new Laya.Vector3,t.yawPitchRoll=new Laya.Vector3,t.resultRotation=new Laya.Quaternion,t.tempRotationZ=new Laya.Quaternion,t.tempRotationX=new Laya.Quaternion,t.tempRotationY=new Laya.Quaternion,t.rotaionSpeed=6e-5,t}return __extends(t,e),t.prototype.onAwake=function(){Laya.stage.on(Laya.Event.RIGHT_MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.RIGHT_MOUSE_UP,this,this.mouseUp),this.camera=this.owner},t.prototype._onDestroy=function(){Laya.stage.off(Laya.Event.RIGHT_MOUSE_DOWN,this,this.mouseDown),Laya.stage.off(Laya.Event.RIGHT_MOUSE_UP,this,this.mouseUp)},t.prototype.onUpdate=function(){var e=Laya.timer.delta;if(!isNaN(this.lastMouseX)&&!isNaN(this.lastMouseY)&&this.isMouseDown){this.owner.scene;Laya.KeyBoardManager.hasKeyDown(87)&&this.moveForward(-.01*e),Laya.KeyBoardManager.hasKeyDown(83)&&this.moveForward(.01*e),Laya.KeyBoardManager.hasKeyDown(65)&&this.moveRight(-.01*e),Laya.KeyBoardManager.hasKeyDown(68)&&this.moveRight(.01*e),Laya.KeyBoardManager.hasKeyDown(81)&&this.moveVertical(.01*e),Laya.KeyBoardManager.hasKeyDown(69)&&this.moveVertical(-.01*e);var t=Laya.stage.mouseX-this.lastMouseX,n=Laya.stage.mouseY-this.lastMouseY,a=this.yawPitchRoll;a.x-=t*this.rotaionSpeed*e,a.y-=n*this.rotaionSpeed*e,this.updateRotation()}this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY},t.prototype.mouseDown=function(e){this.camera.transform.localRotation.getYawPitchRoll(this.yawPitchRoll),this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY,this.isMouseDown=!0},t.prototype.mouseUp=function(e){this.isMouseDown=!1},t.prototype.moveForward=function(e){this._tempVector3.x=0,this._tempVector3.y=0,this._tempVector3.z=e,this.camera.transform.translate(this._tempVector3)},t.prototype.moveRight=function(e){this._tempVector3.y=0,this._tempVector3.z=0,this._tempVector3.x=e,this.camera.transform.translate(this._tempVector3)},t.prototype.moveVertical=function(e){this._tempVector3.x=this._tempVector3.z=0,this._tempVector3.y=e,this.camera.transform.translate(this._tempVector3,!1)},t.prototype.updateRotation=function(){Math.abs(this.yawPitchRoll.y)<1.5&&(Laya.Quaternion.createFromYawPitchRoll(this.yawPitchRoll.x,this.yawPitchRoll.y,this.yawPitchRoll.z,this.tempRotationZ),this.tempRotationZ.cloneTo(this.camera.transform.localRotation),this.camera.transform.localRotation=this.camera.transform.localRotation)},t}(Laya.Script3D);n["default"]=a},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){this.curState=new o("",null,null,null),this.stateHashTabel={}}return e.prototype.AddState=function(e){null!=e&&(this.stateHashTabel[e.key]=e)},e.prototype.AddAction=function(e,t,n,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===a&&(a=null),this.AddState(new o(e,t,n,a))},e.prototype.Switch=function(e,t){void 0===t&&(t=null);var n=this.curState,a=this.stateHashTabel[e];null!=a&&a.key!=n.key&&(null!=n&&n.OnExit(),this.curState=a,a.OnEnter(t))},e.prototype.Update=function(){null!=this.curState&&this.curState.OnUpdate()},e}();n["default"]=a;var o=function(){function e(e,t,n,a){this.key=e,this.enter=t,this.exit=n,this.update=a,null!=this.enter&&(this.enter.once=!1),null!=this.exit&&(this.exit.once=!1),null!=this.update&&(this.update.once=!1)}return e.prototype.OnEnter=function(e){null!=this.enter&&this.enter.runWith(e)},e.prototype.OnExit=function(){null!=this.exit&&this.exit.run()},e.prototype.OnUpdate=function(){null!=this.update&&this.update.run()},e}();n.FsmState=o},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.GetTrigger=function(e){var n=e.getComponent(t);return null==n&&(n=e.addComponent(t)),n},t.prototype.OnTriggerEnter=function(e,n){n&&this.owner.on(t.triggerenter,e,n)},t.prototype.OnTriggerExit=function(e,n){n&&this.owner.on(t.triggerexit,e,n)},t.prototype.OnTriggerStay=function(e,n){n&&this.owner.on(t.triggerstay,e,n)},t.prototype.onEnable=function(){},t.prototype.onDisable=function(){this.owner.offAll(t.triggerenter),this.owner.offAll(t.triggerstay),this.owner.offAll(t.triggerexit)},t.prototype.onTriggerEnter=function(e){this.owner.event(t.triggerenter,[this.owner,e])},t.prototype.onTriggerExit=function(e){this.owner.event(t.triggerexit,[this.owner,e])},t.prototype.onTriggerStay=function(e){this.owner.event(t.triggerstay,[this.owner,e])},t.triggerenter="triggerenter3d",t.triggerstay="triggerstay3d",t.triggerexit="triggerexit3d",t}(Laya.Script3D);n["default"]=a},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GameConst"),o=function(){function e(){}return e.Load=function(t,n,a){console.log(t),Laya.loader.load(t,Laya.Handler.create(this,function(){var o=Laya.loader.getRes(t);return null==o?void console.log("访问Version文件资源失败！"+t):(t=t.replace("/Version.json",""),e.LoadJons(t,o),void(null!=a&&a.call(n)))}),null,Laya.Loader.JSON)},e.LoadJons=function(t,n){var o=n.songs;if(null==o)return void console.log("当前版本无歌曲!"+t);for(var i=0;i<o.length;i++){var r=o[i],s=t+a["default"].SoundFile,l=t+a["default"].SoundPreviewImages,u=e.objToSong(r,s,l);e.songs.push(u)}var c=n.enableCharge;this.enableCharge=1==c},e.objToSong=function(e,t,n){var a=e.name,o=e.songName,i=new r(a,o),s=e.pngs;return i.rootPath=t,i.rootPreviewImage=n,i.SetPreviewImages(s),i.chargeType=e.enableCharge?e.enableCharge:0,i.costPower=e.costPower,i.showOneColor=1==e.showOneColor,i},e.Clear=function(){this.songs=new Array},e.songs=new Array,e.enableCharge=!0,e}();n["default"]=o;var i;!function(e){e[e.Free=0]="Free",e[e.Power=1]="Power",e[e.Video=2]="Video"}(i=n.ChargeType||(n.ChargeType={}));var r=function(){function e(e,t){this.name="",this.songName="",this.rootPath="",this.rootPreviewImage="",this.chargeType=0,this.costPower=0,this.showOneColor=!1,this.enableBand=!0,this.previewPngs=null,this.name=e,this.songName=t,this.previewPngs=new Array}return e.prototype.SetPreviewImages=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=this.rootPreviewImage+e[t];this.previewPngs.push(n)}},e.prototype.getSoundPath=function(e){return this.rootPath+this.name+"/"+this.name+e},Object.defineProperty(e.prototype,"songPath",{get:function(){return this.getSoundPath(".ogg")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"songJosnPath",{get:function(){return this.getSoundPath(".mc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"songBandPath",{get:function(){return this.getSoundPath(".band")},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.name,this.songName);return t.rootPath=this.rootPath,t.rootPreviewImage=this.rootPreviewImage,t.chargeType=this.chargeType,t.costPower=this.costPower,t.showOneColor=this.showOneColor,this.enableBand=this.enableBand,this.previewPngs=this.previewPngs,t},e}();n.Song=r,r.prototype.toString=function(){return"Name:"+this.Name+"Path:"+this.Path+"SongName:"+this.SongName}},{"./GameConst":13}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Net/HttpUnit"),o=e("../AppConfig"),i=e("../WXAPI"),r=e("../User/User"),s=function(){function e(){}return e.request=function(t){t.url.indexOf("https://")>-1||t.url.indexOf("http://")>-1?t.url=t.url:t.url=e.mainUrl+t.url;var n=function(n){console.log(n,"MaiLiang http Success"),n=JSON.parse(n),"200"==n.Status?(null!=n.Result.OpenId&&""!=n.Result.OpenId?(e.MaiLiangOpenId=n.Result.OpenId,e.time=t.data.posttime,console.log("获得买量系统OpenId "+e.MaiLiangOpenId)):console.log("上报买量系统停留时间成功"),t.onSuccess&&t.onSuccess(n)):t.onFail&&t.onFail(n),t.onSuccess=null,t=null},a=function(e){console.log(e,"MaiLiang http fail"),t.onFail&&t.onFail(e),t.onFail=null,t=null},o=new Laya.HttpRequest;if(o.once(Laya.Event.COMPLETE,this,n),o.once(Laya.Event.ERROR,this,a),"get"==t.meth){for(var i="",r=0,s=Object.keys(t.data);r<s.length;r++){var l=s[r],u=t.data[l];i+=l+"="+u+"&"}t.url=t.url+"?"+i,o.send(t.url,null,t.meth)}else{for(var i="",c=0,h=Object.keys(t.data);c<h.length;c++){var l=h[c],u=t.data[l];i+=l+"="+u+"&"}o.send(t.url,i,t.meth,null,["Content-Type","application/x-www-form-urlencoded"])}},e.GetMaiLiangOpenId=function(t,n){if(Laya.Browser.onMiniGame){var s=i["default"].getLaunchOptionsSync();if(null!=s){var l=s.query.key;if(null!=l&&""!=l&&""!=r["default"].openId){e.key=l;var u=new a.requestData;u.url=e.uclick,u.onSuccess=t,u.onFail=n,u.data.appid=o["default"].AppID,u.data.openid="";var c=(new Date).getTime()/1e3;u.data.posttime=c,u.data.auth=0,u.data.key=l,u.data.wxopenid=r["default"].openId,u.meth="POST",console.log("发送买量数据接口"),e.request(u)}}else console.log("上报买量数据失败"),n(null)}else console.log("不在微信模式下调用，默认上报买量数据失败"),n(null)},e.ReportStayTime=function(t,n){if(Laya.Browser.onMiniGame){if(""!=e.MaiLiangOpenId){var i=new a.requestData;i.url=e.stay,i.onSuccess=t,i.onFail=n,i.data.appid=o["default"].AppID,i.data.openid=e.MaiLiangOpenId;var r=(new Date).getTime()/1e3;i.data.posttime=r;var s=0!=e.time?r-e.time:0;i.data.time=s,i.meth="POST",console.log("发送停留时间至买量接口"),e.request(i)}}else console.log("不在微信模式下调用，默认发送停留时间至买量接口失败"),n(null)},e.mainUrl="",e.uclick="",e.stay="",e.key="",e.MaiLiangOpenId="",e.time=0,e}();n["default"]=s},{"../AppConfig":2,"../Net/HttpUnit":32,"../User/User":40,"../WXAPI":58}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GameConfig"),o=e("./User/User"),i=e("./ui/layaMaxUI"),r=e("./View/LoadingView/LoadingView"),s=e("./Net/HttpUnit"),l=e("./WXAPI"),u=e("./AppConfig"),c=e("./Event/EventMgr"),h=e("./Event/EventDef"),d=e("./Game/GameConst"),f=e("./NativeCallback"),p=function(){function e(){this._loadingUI=null,this._loadingView=null,this._preLoadRes=new Array,window.Laya3D?Laya3D.init(a["default"].width,a["default"].height):Laya.init(a["default"].width,a["default"].height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=a["default"].scaleMode,Laya.stage.screenMode=a["default"].screenMode,Laya.URL.exportSceneToJson=a["default"].exportSceneToJson,(a["default"].debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),a["default"].physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),a["default"].stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.Browser.onMiniGame||(u["default"].ResServer=u["default"].LocalTestReServer),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){
this.initLoadingView();var e=[{url:u["default"].ResServer+"/json/appswitch.json",type:Laya.Loader.JSON}],t=this;Laya.loader.load(e,Laya.Handler.create(this,function(){t.loadRes()})),c["default"].instance.regOnceEvent(h.EventDef.App_CloseFirstLoadingView,this,this.closeloadingUI)},e.prototype.initLoadingView=function(){this._loadingUI=new i.ui.View.LoadingUI,Laya.stage.addChild(this._loadingUI),this._loadingUI.width=Laya.stage.width,this._loadingUI.height=Laya.stage.height,this._loadingView=this._loadingUI.getComponent(r["default"]),this._loadingView.setProcess(0)},e.prototype.postResToOpenDataContext=function(e){Laya.Browser.onMiniGame?(console.log("开始透传资源数据到开放域"),Laya.loader.load(["openRes/Rank.atlas"],Laya.Handler.create(null,function(){Laya.MiniAdpter.sendAtlasToOpenDataContext("openRes/Rank.atlas"),console.log("透传资源数据到开放域  完毕！！！"),e&&e()}))):e&&e()},e.prototype.preLoad=function(){this._preLoadRes.push({url:d["default"].GetRemoteVersionPath,type:Laya.Loader.JSON}),this._preLoadRes.push({url:d["default"].GetLocalSubResVersionPath,type:Laya.Loader.JSON})},e.prototype.loadRes=function(){var e=this;this.preLoad();var t=this._preLoadRes,n=this;if(Laya.Browser.onMiniGame){var a=Laya.Browser.window.wx.loadSubpackage({name:"subRes",success:function(a){t.length>0?Laya.loader.load(t,Laya.Handler.create(e,function(){n.onLoadResComplate()}),Laya.Handler.create(e,function(e){n._loadingView.setProcess(e/2+.5)})):n.onLoadResComplate()},fail:function(t){e.loadRes()}});a.onProgressUpdate(function(e){n._loadingView.setProcess(2*e)})}else t.length>0?Laya.loader.load(t,Laya.Handler.create(this,function(){n.onLoadResComplate()}),Laya.Handler.create(this,function(e){n._loadingView.setProcess(e)})):n.onLoadResComplate()},e.prototype.onLoadResComplate=function(){this._loadingView.setProcess(1),Laya.Browser.onMiniGame?l["default"].wxLogin(function(e){var t=this;o["default"].code=e,s["default"].login(function(e){1==e.code&&(console.log("登陆成功！！！"),o["default"].token=e.data.token,o["default"].openId=e.data.openid,s["default"].getGameData(function(e){console.log("获取用户数据成功！！！"),1==e.code?o["default"].initiUser(e.data):o["default"].initiUser(null),a["default"].startScene&&Laya.Scene.open(a["default"].startScene,!1,Laya.Handler.create(t,function(){}))},function(e){console.log("获取用户数据失败！！！"),o["default"].initiUser(null),a["default"].startScene&&Laya.Scene.open(a["default"].startScene,!1,Laya.Handler.create(t,function(){}))}))},function(e){console.log("登陆失败！！！"+e),o["default"].initiUser(null),a["default"].startScene&&Laya.Scene.open(a["default"].startScene,!1,Laya.Handler.create(t,function(){}))})},null):(o["default"].testInitUser(),a["default"].startScene&&Laya.Scene.open(a["default"].startScene,!1,Laya.Handler.create(this,function(){})))},e.prototype.closeloadingUI=function(){this._loadingUI&&!this._loadingUI.destroyed&&this._loadingUI.destroy()},e}();new p,Laya.Browser.window&&(Laya.Browser.window.NativeCallback=f["default"])},{"./AppConfig":2,"./Event/EventDef":4,"./Event/EventMgr":5,"./Game/GameConst":13,"./GameConfig":6,"./NativeCallback":30,"./Net/HttpUnit":32,"./User/User":40,"./View/LoadingView/LoadingView":54,"./WXAPI":58,"./ui/layaMaxUI":59}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./ViewMgr"),o=e("../User/User"),i=e("../MaiLiangAPI/MaiLiang"),r=e("../Event/EventMgr"),s=e("../Event/EventDef"),l=e("../WXAPI"),u=e("../Game/GameController"),c=e("../Game/Version"),h=e("../Game/GameConst"),d=e("../Game/SoundManager"),f=function(e){function t(){var n=e.call(this)||this;return t._instance=n,n}return __extends(t,e),t.getInstance=function(){return t._instance},t.prototype.onAwake=function(){i["default"].GetMaiLiangOpenId(function(e){console.log("GameUI 买量数据上报成功"),Laya.Browser.window.wx.onShow(function(){i["default"].GetMaiLiangOpenId(null,null)}),Laya.Browser.window.wx.onHide(function(){i["default"].ReportStayTime(null,null)})},function(e){console.log("GameUI 买量数据上报失败")}),l["default"].SetShareMenu("","",function(){},function(){},function(){})},t.prototype.onStart=function(){this.Test(),this.preCreateGame()},t.prototype.Test=function(){Laya.Browser.onMiniGame?(Laya.Browser.window.wx.onShow(function(){r["default"].instance.dispatch(s.EventDef.Game_FOCUS)}),Laya.Browser.window.wx.onHide(function(){r["default"].instance.dispatch(s.EventDef.Game_BLUR)})):(Laya.stage.on(Laya.Event.BLUR,this,function(){r["default"].instance.dispatch(s.EventDef.Game_BLUR)}),Laya.stage.on(Laya.Event.FOCUS,this,function(){r["default"].instance.dispatch(s.EventDef.Game_FOCUS)}))},t.prototype.preCreateGame=function(){Laya.Browser.onMiniGame&&(Laya.MiniAdpter.autoCacheFile=!0),Laya.SoundManager.autoStopMusic=!1,c["default"].Load(h["default"].GetLocalSubResVersionPath),this.LoadGame(),this.save_myqq_GameData()},t.prototype.LoadGame=function(){var e=this;u["default"].Instance.Init(this,function(){if(d["default"].Instance.IsFirstEnterGame()){var t=c["default"].songs[0].clone();t.showOneColor=!0,t.chargeType=c.ChargeType.Free,o["default"].addMoney(10),d["default"].Instance.PlaySong(t,e,function(){r["default"].instance.dispatch(s.EventDef.App_CloseFirstLoadingView)})}else a["default"].instance.openView(a.ViewDef.GameMainView,null,function(){r["default"].instance.dispatch(s.EventDef.App_CloseFirstLoadingView)})})},t.prototype.save_myqq_GameData=function(e,t){var n=function(n){t&&t.call(e,n)};localStorage.setItem("Game_Data",o["default"].getSaveData()),n(!0)},t._instance=null,t}(Laya.Script);n["default"]=f},{"../Event/EventDef":4,"../Event/EventMgr":5,"../Game/GameConst":13,"../Game/GameController":14,"../Game/SoundManager":19,"../Game/Version":23,"../MaiLiangAPI/MaiLiang":24,"../User/User":40,"../WXAPI":58,"./ViewMgr":29}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){this._enabled=!0}return Object.defineProperty(e.prototype,"Enabled",{get:function(){return this._enabled},set:function(e){e||this.stopBGM(),this._enabled=e},enumerable:!0,configurable:!0}),e.prototype.getSoundUrl=function(t){var n=e.soundResPath+t+".ogg";return n},e.prototype.playSound=function(t){if(this._enabled){var n=this.getSoundUrl(t);if(Laya.Browser.onMiniGame){var a=laya.utils.Pool.getItem(t);null==a&&(a=wx.createInnerAudioContext(),a.src=e.soundResPath+t+".ogg",a.onEnded(function(){laya.utils.Pool.recover(t,a),a.offEnded()})),a.play()}else Laya.SoundManager.playSound(n,1)}},e.prototype.playBGM=function(e){if(this._enabled){var t=this.getSoundUrl(e);Laya.Browser.onMiniGame?(this.bgm||(this.bgm=wx.createInnerAudioContext()),this.bgm.stop(),this.bgm.src=t,this.bgm.loop=!0,this.bgm.play()):Laya.SoundManager.playMusic(t,0)}},e.prototype.stopBGM=function(){Laya.Browser.onMiniGame?this.bgm&&this.bgm.stop():Laya.SoundManager.stopMusic()},e.soundResPath="subRes/sound/",e.instance=new e,e}();n["default"]=a},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../NativeCallback"),o=function(){function e(){}return e.vibrateShort=function(){e.isEnable&&(Laya.Browser.onMiniGame?Laya.Browser.window.wx.vibrateShort():a["default"].CallNativeFunc("vibrateShort"))},e.ibrateLong=function(){e.isEnable&&(Laya.Browser.onMiniGame?Laya.Browser.window.wx.vibrateLong():a["default"].CallNativeFunc("vibrateLong"))},e.vibrate=function(t){if(e.isEnable&&Laya.Browser.onMiniGame){var n=t/15,a=0,o={count:n,index:a};Laya.timer.loop(16,o,function(){e.vibrateShort(),a++,a>n&&Laya.timer.clearAll(o)})}},e.isEnable=!1,e}();n["default"]=o},{"../NativeCallback":30}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a;!function(e){e.None="",e.TipsView="View/TipsView.scene",e.GameMainView="View/GameMain.scene",e.GameLoadingView="View/GameLoading.scene",e.GameSettleView="View/GameSettleView.scene",e.GameFailureView="View/GameFailure.scene",e.GameWorkView="View/GameWork.scene",e.SongStoreView="View/SongStore.scene",e.ExportView="View/ExportView.scene"}(a=n.ViewDef||(n.ViewDef={}));var o=function(){function e(){this._views={}}return e.prototype.openView=function(e,t,n){if(this._views[e]){var a=this._views[e],o=a._components,i=null;if(o)for(var r=0;r<o.length;r++){var s=o[r];if(s._viewBase){s.openView(t),n&&n(s);break}}return void(n&&n(i))}var l=String(e),u=this;Laya.Scene.load(l,Laya.Handler.create(this,function(a){Laya.stage.addChild(a);var o=a;u._views[e]=o;var i=a._components,r=null;if(i)for(var s=0;s<i.length;s++){var l=i[s];if(l._viewBase){r=l,l._viewDef=e,r.openView(t);break}}n&&n(r)}))},e.prototype.closeView=function(e){var t=this._views[e];if(t){var n=t,a=n._components;if(a)for(var o=0;o<a.length;o++){var i=a[o];if(i._viewBase){i.onClose();break}}t.removeSelf(),t.destroy(),this._views[e]=null}},e.prototype.ShowView=function(e){var t=this._views[e];if(t){var n=t._components;if(n)for(var a=0;a<n.length;a++){var o=n[a];if(o._viewBase){o.show();break}}}},e.prototype.hideView=function(e){var t=this._views[e];if(t){var n=t._components;if(n)for(var a=0;a<n.length;a++){var o=n[a];if(o._viewBase){o.hide();break}}}},e.prototype.getView=function(e){return this._views[e]},e.prototype.showTips=function(e){this.openView(a.TipsView,e)},e.instance=new e,e}();n["default"]=o},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Event/EventDef"),o=e("./Event/EventMgr"),i=function(){function e(){}return e.onVideoFail=function(){o["default"].instance.dispatch(a.EventDef.RewardVideoFail),Laya.SoundManager.muted=!1},e.onVideoSuccess=function(e){o["default"].instance.dispatch(a.EventDef.RewardVideoSuccess,e),Laya.SoundManager.muted=!1},e.onInsertVideoEnd=function(){console.debug("onInsertVideoEnd    --------- ------------ "),o["default"].instance.dispatch(a.EventDef.InsertVideoEnd)},e.onPause=function(){console.debug("进入后台 静音"),Laya.SoundManager.muted=!0,o["default"].instance.dispatch(a.EventDef.Game_BLUR)},e.onResume=function(){console.debug("恢复---------"),Laya.SoundManager.muted=!1,o["default"].instance.dispatch(a.EventDef.Game_FOCUS)},e.CallNativeFunc=function(e){if(Laya.Browser.onAndroid){var t=window.PlatformClass.createClass("demo.JSBridge");t.call(e)}else Laya.Browser.onIOS},e.ShowLog=function(e){if(console.log("输出native日志---"+e),Laya.Browser.onAndroid){var t=window.PlatformClass.createClass("demo.JSBridge");t.call("showLog",e)}else Laya.Browser.onIOS},e.NowVideoType="",e.conchIOS="Conch-ios",e.conchAndroid="Conch-android",e.os="",e}();n["default"]=i},{"./Event/EventDef":4,"./Event/EventMgr":5}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./aes.js"),o=function(){function e(){}return e.encrypt=function(t){var n=a.enc.Utf8.parse(e.KEY),o=a.enc.Utf8.parse(e.IV),i=a.AES.encrypt(t,n,{iv:o,mode:a.mode.CBC,padding:a.pad.Pkcs7});return i.toString()},e.decrypt=function(t){var n=a.enc.Utf8.parse(e.KEY),o=a.enc.Utf8.parse(e.IV),i=a.AES.decrypt(t,n,{iv:o,padding:a.pad.Pkcs7});return i.toString(a.enc.Utf8)},e.KEY="b#63fFJ6AvkK3YT*",e.IV="J$f4DU%sNL73M&Go",e}();n["default"]=o},{"./aes.js":34}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./NetConfig"),o=e("../User/User"),i=e("./AesTools"),r=function(){function e(){this.meth="post",this.url="",this.onSuccess=null,this.onFail=null,this.data={}}return e}();n.requestData=r;var s=function(){function e(){}return e.request=function(t){t.url.indexOf("https://")>-1||t.url.indexOf("http://")>-1?t.url=t.url:t.url=a["default"].serverUrl+t.url;var n=function(e){console.log(e,"http Success"),t.onSuccess&&t.onSuccess(e),t.onSuccess=null,t=null},r=function(e){console.log(e,"http fail"),t.onFail&&t.onFail(e),t.onFail=null,t=null},s=new Laya.HttpRequest;s.once(Laya.Event.COMPLETE,e,n),s.once(Laya.Event.ERROR,e,r);JSON.stringify(t.data);t.data.code=o["default"].code;var l="time="+String(Date.now()),u=["Content-Type","application/json","state",0,"gameid",a["default"].gameid,"sign",i["default"].encrypt(l)];o["default"].token&&(u.push("token"),u.push(o["default"].token)),s.send(t.url,JSON.stringify(t.data),t.meth,"json",u)},e.login=function(t,n){var o=new r;o.url=a["default"].Login,o.onSuccess=t,o.onFail=n,e.request(o)},e.saveGameData=function(t,n,o){var i=new r;i.url=a["default"].SaveGameData,i.data.gameData=t,i.onSuccess=n,i.onFail=o,e.request(i)},e.getGameData=function(t,n){var o=new r;o.url=a["default"].GetUser,o.onSuccess=t,o.onFail=n,e.request(o)},e.GetIpBlock=function(t,n){var o=new r;o.url=a["default"].IpBlock,o.onSuccess=t,o.onFail=n,e.request(o)},e}();n["default"]=s},{"../User/User":40,"./AesTools":31,"./NetConfig":33}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){}return e.gameid=16,e.serverUrl="",e.Login="",e.SaveGameData="",e.GetUser="r",e.IpBlock="",e}();n["default"]=a},{}],34:[function(e,t,n){var a=a||function(e,t){var n={},a=n.lib={},o=function(){},i=a.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=a.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,a=this.sigBytes;if(e=e.sigBytes,this.clamp(),a%4)for(var o=0;e>o;o++)t[a+o>>>2]|=(n[o>>>2]>>>24-8*(o%4)&255)<<24-8*((a+o)%4);else if(65535<n.length)for(o=0;e>o;o+=4)t[a+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],a=0;t>a;a+=4)n.push(4294967296*e.random()|0);return new r.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],a=0;e>a;a++){var o=t[a>>>2]>>>24-8*(a%4)&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],a=0;t>a;a+=2)n[a>>>3]|=parseInt(e.substr(a,2),16)<<24-4*(a%8);return new r.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],a=0;e>a;a++)n.push(String.fromCharCode(t[a>>>2]>>>24-8*(a%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],a=0;t>a;a++)n[a>>>2]|=(255&e.charCodeAt(a))<<24-8*(a%4);return new r.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,a=n.words,o=n.sigBytes,i=this.blockSize,s=o/(4*i),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*i,o=e.min(4*t,o),t){for(var l=0;t>l;l+=i)this._doProcessBlock(a,l);l=a.splice(0,t),n.sigBytes-=o}return new r.init(l,o)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=h.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}});var d=n.algo={};return n}(Math);!function(){var e=a,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,a=this._map;e.clamp(),e=[];for(var o=0;n>o;o+=3)for(var i=(t[o>>>2]>>>24-8*(o%4)&255)<<16|(t[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|t[o+2>>>2]>>>24-8*((o+2)%4)&255,r=0;4>r&&n>o+.75*r;r++)e.push(a.charAt(i>>>6*(3-r)&63));if(t=a.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,a=this._map,o=a.charAt(64);o&&(o=e.indexOf(o),-1!=o&&(n=o));for(var o=[],i=0,r=0;n>r;r++)if(r%4){var s=a.indexOf(e.charAt(r-1))<<2*(r%4),l=a.indexOf(e.charAt(r))>>>6-2*(r%4);o[i>>>2]|=(s|l)<<24-8*(i%4),i++}return t.create(o,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,a,o,i,r){return e=e+(t&n|~t&a)+o+r,(e<<i|e>>>32-i)+t}function n(e,t,n,a,o,i,r){return e=e+(t&a|n&~a)+o+r,(e<<i|e>>>32-i)+t}function o(e,t,n,a,o,i,r){return e=e+(t^n^a)+o+r,(e<<i|e>>>32-i)+t}function i(e,t,n,a,o,i,r){return e=e+(n^(t|~a))+o+r,(e<<i|e>>>32-i)+t}for(var r=a,s=r.lib,l=s.WordArray,u=s.Hasher,s=r.algo,c=[],h=0;64>h;h++)c[h]=4294967296*e.abs(e.sin(h+1))|0;s=s.MD5=u.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var r=0;16>r;r++){var s=a+r,l=e[s];e[s]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var r=this._hash.words,s=e[a+0],l=e[a+1],u=e[a+2],h=e[a+3],d=e[a+4],f=e[a+5],p=e[a+6],g=e[a+7],y=e[a+8],m=e[a+9],v=e[a+10],w=e[a+11],_=e[a+12],S=e[a+13],L=e[a+14],C=e[a+15],b=r[0],B=r[1],V=r[2],M=r[3],b=t(b,B,V,M,s,7,c[0]),M=t(M,b,B,V,l,12,c[1]),V=t(V,M,b,B,u,17,c[2]),B=t(B,V,M,b,h,22,c[3]),b=t(b,B,V,M,d,7,c[4]),M=t(M,b,B,V,f,12,c[5]),V=t(V,M,b,B,p,17,c[6]),B=t(B,V,M,b,g,22,c[7]),b=t(b,B,V,M,y,7,c[8]),M=t(M,b,B,V,m,12,c[9]),V=t(V,M,b,B,v,17,c[10]),B=t(B,V,M,b,w,22,c[11]),b=t(b,B,V,M,_,7,c[12]),M=t(M,b,B,V,S,12,c[13]),V=t(V,M,b,B,L,17,c[14]),B=t(B,V,M,b,C,22,c[15]),b=n(b,B,V,M,l,5,c[16]),M=n(M,b,B,V,p,9,c[17]),V=n(V,M,b,B,w,14,c[18]),B=n(B,V,M,b,s,20,c[19]),b=n(b,B,V,M,f,5,c[20]),M=n(M,b,B,V,v,9,c[21]),V=n(V,M,b,B,C,14,c[22]),B=n(B,V,M,b,d,20,c[23]),b=n(b,B,V,M,m,5,c[24]),M=n(M,b,B,V,L,9,c[25]),V=n(V,M,b,B,h,14,c[26]),B=n(B,V,M,b,y,20,c[27]),b=n(b,B,V,M,S,5,c[28]),M=n(M,b,B,V,u,9,c[29]),V=n(V,M,b,B,g,14,c[30]),B=n(B,V,M,b,_,20,c[31]),b=o(b,B,V,M,f,4,c[32]),M=o(M,b,B,V,y,11,c[33]),V=o(V,M,b,B,w,16,c[34]),B=o(B,V,M,b,L,23,c[35]),b=o(b,B,V,M,l,4,c[36]),M=o(M,b,B,V,d,11,c[37]),V=o(V,M,b,B,g,16,c[38]),B=o(B,V,M,b,v,23,c[39]),b=o(b,B,V,M,S,4,c[40]),M=o(M,b,B,V,s,11,c[41]),V=o(V,M,b,B,h,16,c[42]),B=o(B,V,M,b,p,23,c[43]),b=o(b,B,V,M,m,4,c[44]),M=o(M,b,B,V,_,11,c[45]),V=o(V,M,b,B,C,16,c[46]),B=o(B,V,M,b,u,23,c[47]),b=i(b,B,V,M,s,6,c[48]),M=i(M,b,B,V,g,10,c[49]),V=i(V,M,b,B,L,15,c[50]),B=i(B,V,M,b,f,21,c[51]),b=i(b,B,V,M,_,6,c[52]),M=i(M,b,B,V,h,10,c[53]),V=i(V,M,b,B,v,15,c[54]),B=i(B,V,M,b,l,21,c[55]),b=i(b,B,V,M,y,6,c[56]),M=i(M,b,B,V,C,10,c[57]),V=i(V,M,b,B,p,15,c[58]),B=i(B,V,M,b,S,21,c[59]),b=i(b,B,V,M,d,6,c[60]),M=i(M,b,B,V,w,10,c[61]),V=i(V,M,b,B,u,15,c[62]),B=i(B,V,M,b,m,21,c[63]);r[0]=r[0]+b|0,r[1]=r[1]+B|0,r[2]=r[2]+V|0,r[3]=r[3]+M|0},_doFinalize:function(){var t=this._data,n=t.words,a=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var i=e.floor(a/4294967296);for(n[(o+64>>>9<<4)+15]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[(o+64>>>9<<4)+14]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,a=0;4>a;a++)o=n[a],n[a]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}}),r.MD5=u._createHelper(s),r.HmacMD5=u._createHmacHelper(s)}(Math),function(){var e=a,t=e.lib,n=t.Base,o=t.WordArray,t=e.algo,i=t.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,a=n.hasher.create(),i=o.create(),r=i.words,s=n.keySize,n=n.iterations;r.length<s;){l&&a.update(l);var l=a.update(e).finalize(t);a.reset();for(var u=1;n>u;u++)l=a.finalize(l),a.reset();i.concat(l)}return i.sigBytes=4*s,i}});e.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}}(),a.lib.Cipher||function(e){var t=a,n=t.lib,o=n.Base,i=n.WordArray,r=n.BufferedBlockAlgorithm,s=t.enc.Base64,l=t.algo.EvpKDF,u=n.Cipher=r.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,a){return("string"==typeof n?g:p).encrypt(e,t,n,a)},decrypt:function(t,n,a){return("string"==typeof n?g:p).decrypt(e,t,n,a)}}}});n.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=t.mode={},h=function(t,n,a){var o=this._iv;o?this._iv=e:o=this._prevBlock;for(var i=0;a>i;i++)t[n+i]^=o[i]},d=(n.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();d.Encryptor=d.extend({processBlock:function(e,t){var n=this._cipher,a=n.blockSize;h.call(this,e,t,a),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+a)}}),d.Decryptor=d.extend({processBlock:function(e,t){var n=this._cipher,a=n.blockSize,o=e.slice(t,t+a);n.decryptBlock(e,t),h.call(this,e,t,a),this._prevBlock=o}}),c=c.CBC=d,d=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,a=n<<24|n<<16|n<<8|n,o=[],r=0;n>r;r+=4)o.push(a);n=i.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},n.BlockCipher=u.extend({cfg:u.cfg.extend({mode:c,padding:d}),reset:function(){u.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var f=n.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){e=s.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return f.create({ciphertext:e,salt:n})}},p=n.SerializableCipher=o.extend({cfg:o.extend({format:c}),encrypt:function(e,t,n,a){a=this.cfg.extend(a);var o=e.createEncryptor(n,a);return t=o.finalize(t),o=o.cfg,f.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:a.format})},decrypt:function(e,t,n,a){return a=this.cfg.extend(a),t=this._parse(t,a.format),e.createDecryptor(n,a).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,a){return a||(a=i.random(8)),e=l.create({keySize:t+n}).compute(e,a),n=i.create(e.words.slice(t),4*n),e.sigBytes=4*t,f.create({key:e,iv:n,salt:a})}},g=n.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:t}),encrypt:function(e,t,n,a){return a=this.cfg.extend(a),n=a.kdf.execute(n,e.keySize,e.ivSize),a.iv=n.iv,e=p.encrypt.call(this,e,t,n.key,a),e.mixIn(n),e},decrypt:function(e,t,n,a){return a=this.cfg.extend(a),t=this._parse(t,a.format),n=a.kdf.execute(n,e.keySize,e.ivSize,t.salt),a.iv=n.iv,p.decrypt.call(this,e,t,n.key,a)}})}(),function(){for(var e=a,t=e.lib.BlockCipher,n=e.algo,o=[],i=[],r=[],s=[],l=[],u=[],c=[],h=[],d=[],f=[],p=[],g=0;256>g;g++)p[g]=128>g?g<<1:g<<1^283;for(var y=0,m=0,g=0;256>g;g++){var v=m^m<<1^m<<2^m<<3^m<<4,v=v>>>8^255&v^99;o[y]=v,i[v]=y;var w=p[y],_=p[w],S=p[_],L=257*p[v]^16843008*v;r[y]=L<<24|L>>>8,s[y]=L<<16|L>>>16,l[y]=L<<8|L>>>24,u[y]=L,L=16843009*S^65537*_^257*w^16843008*y,c[v]=L<<24|L>>>8,h[v]=L<<16|L>>>16,d[v]=L<<8|L>>>24,f[v]=L,y?(y=w^p[p[p[S^w]]],m^=p[p[m]]):y=m=1}var C=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,e=4*((this._nRounds=n+6)+1),a=this._keySchedule=[],i=0;e>i;i++)if(n>i)a[i]=t[i];else{var r=a[i-1];i%n?n>6&&4==i%n&&(r=o[r>>>24]<<24|o[r>>>16&255]<<16|o[r>>>8&255]<<8|o[255&r]):(r=r<<8|r>>>24,r=o[r>>>24]<<24|o[r>>>16&255]<<16|o[r>>>8&255]<<8|o[255&r],r^=C[i/n|0]<<24),a[i]=a[i-n]^r}for(t=this._invKeySchedule=[],n=0;e>n;n++)i=e-n,r=n%4?a[i]:a[i-4],t[n]=4>n||4>=i?r:c[o[r>>>24]]^h[o[r>>>16&255]]^d[o[r>>>8&255]]^f[o[255&r]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,s,l,u,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,c,h,d,f,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,a,o,i,r,s){for(var l=this._nRounds,u=e[t]^n[0],c=e[t+1]^n[1],h=e[t+2]^n[2],d=e[t+3]^n[3],f=4,p=1;l>p;p++)var g=a[u>>>24]^o[c>>>16&255]^i[h>>>8&255]^r[255&d]^n[f++],y=a[c>>>24]^o[h>>>16&255]^i[d>>>8&255]^r[255&u]^n[f++],m=a[h>>>24]^o[d>>>16&255]^i[u>>>8&255]^r[255&c]^n[f++],d=a[d>>>24]^o[u>>>16&255]^i[c>>>8&255]^r[255&h]^n[f++],u=g,c=y,h=m;g=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&d])^n[f++],y=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[d>>>8&255]<<8|s[255&u])^n[f++],m=(s[h>>>24]<<24|s[d>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^n[f++],d=(s[d>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^n[f++],e[t]=g,e[t+1]=y,e[t+2]=m,e[t+3]=d},keySize:8});e.AES=t._createHelper(n)}(),t.exports=a},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){}return e.refresh_myqq_Ad=function(e){},e.get_myqq_ADVs=function(e,t,n,a){},e.reportUserClick=function(e){},e.get_myqq_RandomADPosID=function(){return e.AdLocationids[Math.floor(Math.random()*e.AdLocationids.length)]},e.request=function(e){},e.getAdPosData=function(e,t){},e.reqUserClick=function(e,t,n){},e.getADVData=function(e,t,n){},e.Random_myqq_Jump=function(e){void 0===e&&(e=1)},e.mainUrl="",e.getAdPostion="",e.getAdv="",e.userClick="",e.LoopAdLocationID=125,e.BannerAdLocationID=127,e.InsertAdLocationID=126,e.AniAdLocationID=128,e.UseRandomAdPos=!0,e.AdLocationids=[125,126],e._adPosition={},e._adv={},e._iphoneIgnoreAppIds=[],e}();n["default"]=a},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ShareAd"),o=e("../../WXAPI"),i=e("../../ALD"),r=e("../../Event/EventMgr"),s=e("../../Event/EventDef"),l=e("../../Config/AppSwitchConfig"),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.AdPosID=a["default"].BannerAdLocationID,t._data=null,t._wxBanner=null,t}return __extends(t,e),t.prototype.onAwake=function(){this._displaySp=this.owner.getChildByName("Display"),null==this._displaySp&&(this._displaySp=this.owner)},t.prototype.onEnable=function(){this._displaySp.on(Laya.Event.CLICK,this,this.onSpClick);var e=l["default"].getInstance().getAppSwitchData().banner;0==e?this.refreshBannerDis():1==e&&this.refreshWXBanner()},t.prototype.onDisable=function(){this._displaySp.off(Laya.Event.CLICK,this,this.onSpClick),this.clearWXBaner()},t.prototype.refreshBannerDis=function(){var e=this;a["default"].get_myqq_ADVs(this.AdPosID,function(t){if(t&&t.length>0){var n=t[Math.floor(Math.random()*t.length)];e._displaySp.loadImage(n.logo,Laya.Handler.create(e,function(){e._displaySp.destroyed||(e._displaySp.width=750,e._displaySp.height=350)})),e._data=n}},!1)},t.prototype.onSpClick=function(){var e=this._data;e&&(console.log("跳转游戏： "+e.title),o["default"].navigateToMiniProgram(e.appid,e.url,function(t){console.log("跳转成功"),a["default"].reportUserClick(e.appid),i["default"].aldSendReportAdClickSuccess(e)},function(t){console.log("跳转失败"),r["default"].instance.dispatch(s.EventDef.AD_OnShareAdFail),"navigateToMiniProgram:fail cancel"==t.errMsg&&(console.log("用户取消跳转"),i["default"].aldSendReportAdClickFail(e))},function(e){console.log("跳转完成")}))},t.prototype.refreshWXBanner=function(){if(Laya.Browser.onMiniGame&&this.owner.visible){this.clearWXBaner();var e=this,t=Laya.Browser.window.wx.getSystemInfoSync(),n=t.screenWidth,a=t.screenHeight,i=this._displaySp.localToGlobal(new Laya.Point(0,0)),r=i.x/Laya.stage.width*n,s=i.y/Laya.stage.height*a,l=this.WXBannerWidth?this.WXBannerWidth/Laya.stage.width*n:n;this._wxBanner=Laya.Browser.window.wx.createBannerAd({adUnitId:o["default"].bannerAdUnitId,adIntervals:30,style:{left:r,top:s,width:l}}),e._wxBanner.onLoad(function(e){console.log("WXBanner广告 加载完成"),console.log(e)}),this._wxBanner.onError(function(t){console.log("WXBanner广告 加载失败"),console.log(t),e.refreshBannerDis(),e.clearWXBaner()}),this._wxBanner.onResize(function(t){console.log(e._wxBanner.style.realWidth,e._wxBanner.style.realHeight)}),e._wxBanner.show()}},t.prototype.clearWXBaner=function(){this._wxBanner&&this._wxBanner.destroy(),this._wxBanner=null},t}(Laya.Script);n["default"]=u},{"../../ALD":1,"../../Config/AppSwitchConfig":3,"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../WXAPI":58,"../ShareAd":35}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ShareAd"),o=e("./LoopAdBox"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.AdPosID=a["default"].LoopAdLocationID,t._scrollForward=!0,t}return __extends(t,e),t.prototype.onAwake=function(){this._list=this.owner.getChildByName("List"),this._list.renderHandler=Laya.Handler.create(this,this.on_myqq_ListRender,null,!1),this._list.hScrollBarSkin=""},t.prototype.onEnable=function(){var e=this,t=this;a["default"].get_myqq_ADVs(this.AdPosID,function(n){if(t.owner&&!t.owner.destroyed)if(n&&n.length>0&&n.length<50){for(var a=[],o=0,i=0;50>i;++i)o>=n.length&&(o=0),a.push(n[o]),++o;for(var r=n.length,i=0;i<a.length;++i){var s=Math.floor(i/r),l=s*r,u=Math.floor(Math.random()*r)+l,c=a[i],h=a[u];a[u]=c,a[i]=h}e._list.array=a}else e._list.array=n})},t.prototype.onDisable=function(){},t.prototype.onUpdate=function(){this._scrollForward?(this._list.scrollBar.value+=100*Laya.timer.delta/1e3,this._list.scrollBar.value>=this._list.scrollBar.max&&(this._scrollForward=!1)):(this._list.scrollBar.value-=100*Laya.timer.delta/1e3,this._list.scrollBar.value<=0&&(this._scrollForward=!0))},t.prototype.on_myqq_ListRender=function(e,t){var n=this._list.array[t],a=e.getComponent(o["default"]);a.set_myqq_Data(n)},t}(Laya.Script);n["default"]=i},{"../ShareAd":35,"./LoopAdBox":38}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../WXAPI"),o=e("../ShareAd"),i=e("../../ALD"),r=e("../../Event/EventMgr"),s=e("../../Event/EventDef"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._data=null,t._originW=150,t._originH=150,t._fontSize=25,t}return __extends(t,e),t.prototype.onAwake=function(){this._displaySp=this.owner.getChildByName("Display"),this._originW=this._displaySp.width,this._originH=this._displaySp.height,this._disText=this.owner.getChildByName("TitelText"),this._disText.text="",this._fontSize=this._disText.fontSize},t.prototype.onEnable=function(){this._displaySp.on(Laya.Event.CLICK,this,this.on_myqq_SpClick)},t.prototype.onDisable=function(){this._displaySp.off(Laya.Event.CLICK,this,this.on_myqq_SpClick)},t.prototype.set_myqq_Data=function(e){if(e){var t=this;this._displaySp.loadImage(e.logo,Laya.Handler.create(this,function(){t._displaySp.destroyed||(t._displaySp.width=t._originW,t._displaySp.height=t._originH)}));var n=String(e.title),a=n.length;a=Math.max(5,a),this._disText.text=n,
this._data=e}},t.prototype.on_myqq_SpClick=function(){var e=this._data;e&&(console.log("跳转游戏： "+e.title),a["default"].navigateToMiniProgram(e.appid,e.url,function(t){console.log("跳转成功"),o["default"].reportUserClick(e.appid),i["default"].aldSendReportAdClickSuccess(e)},function(t){console.log("跳转失败"),r["default"].instance.dispatch(s.EventDef.AD_OnShareAdFail),"navigateToMiniProgram:fail cancel"==t.errMsg&&(console.log("用户取消跳转"),i["default"].aldSendReportAdClickFail(e))},function(e){console.log("跳转完成")}))},t}(Laya.Script);n["default"]=l},{"../../ALD":1,"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../WXAPI":58,"../ShareAd":35}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ShareAd"),o=e("./LoopAdBox"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.AdPosID=a["default"].LoopAdLocationID,t._scrollForward=!0,t}return __extends(t,e),t.prototype.onAwake=function(){this._list=this.owner.getChildByName("List"),this._list.renderHandler=Laya.Handler.create(this,this.on_myqq_ListRender,null,!1),this._list.vScrollBarSkin=""},t.prototype.onEnable=function(){var e=this,t=this;a["default"].get_myqq_ADVs(this.AdPosID,function(n){if(t.owner&&!e.owner.destroyed)if(n&&n.length>0&&n.length<50){e.owner.visible=!0;for(var a=[],o=0,i=0;50>i;++i)o>=n.length&&(o=0),a.push(n[o]),++o;for(var r=n.length,i=0;i<a.length;++i){var s=Math.floor(i/r),l=s*r,u=Math.floor(Math.random()*r)+l,c=a[i],h=a[u];a[u]=c,a[i]=h}e._list.array=a}else e._list.array=n,e.owner.visible=!1})},t.prototype.onDisable=function(){},t.prototype.onUpdate=function(){this._scrollForward?(this._list.scrollBar.value+=100*Laya.timer.delta/1e3,this._list.scrollBar.value>=this._list.scrollBar.max&&(this._scrollForward=!1)):(this._list.scrollBar.value-=100*Laya.timer.delta/1e3,this._list.scrollBar.value<=0&&(this._scrollForward=!0))},t.prototype.on_myqq_ListRender=function(e,t){var n=this._list.array[t],a=e.getComponent(o["default"]);a.set_myqq_Data(n)},t}(Laya.Script);n["default"]=i},{"../ShareAd":35,"./LoopAdBox":38}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Event/EventMgr"),o=e("../Event/EventDef"),i=function(){function e(){this.levelNum=1,this.moneyNum=0,this.crystalNum=0,this.unlockSongs=new Array}return e}();n.UserGameData=i;var r=function(){function e(){this.name="",this.starLevel=0,this.source=0,this.completed=!1}return e}();n.PassSong=r;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getSaveData=function(){return JSON.stringify(t._gameData)},t.testInitUser=function(){var e=localStorage.getItem("Game_Data");console.log("读取存储数据 str----"+e);var n=JSON.parse(e);if(null==n)return t._gameData.levelNum=1,t._gameData.moneyNum=60,t._gameData.crystalNum=0,void(t._gameData.unlockSongs=new Array);var a=n;if(t._gameData.levelNum=a.levelNum?a.levelNum:0,t._gameData.moneyNum=a.moneyNum?a.moneyNum:0,t._gameData.crystalNum=a.crystalNum?a.crystalNum:0,t._gameData.unlockSongs=new Array,null!=a.unlockSongs)for(var o=0;o<a.unlockSongs.length;o++){var i=a.unlockSongs[o],s=new r;s.name=i.name,s.source=i.source,s.starLevel=i.starLevel,s.completed=i.completed?i.completed:!1,t._gameData.unlockSongs.push(s)}},t.initiUser=function(e){if(e&&0!=e){var n=e.gamedata;if(t._gameData.levelNum=n.levelNum?n.levelNum:0,t._gameData.moneyNum=n.moneyNum?n.moneyNum:0,t._gameData.crystalNum=n.crystalNum?n.crystalNum:0,t._gameData.unlockSongs=new Array,null!=n.unlockSongs)for(var a=0;a<n.unlockSongs.length;a++){var o=n.unlockSongs[a],i=new r;i.name=o.name,i.source=o.source,i.starLevel=o.starLevel,i.completed=o.completed?o.completed:!1,t._gameData.unlockSongs.push(i)}}else t._gameData.moneyNum=60,t._gameData.levelNum=0,t._gameData.crystalNum=0,t._gameData.unlockSongs=new Array},t.setLeveNum=function(e){t._gameData.levelNum=e},t.getLeveNum=function(){return t._gameData.levelNum},t.addMoney=function(e){e=Math.ceil(e);var n=t._gameData.moneyNum;t._gameData.moneyNum+=e,a["default"].instance.dispatch(o.EventDef.Game_OnUserMoneyChange,{curr:t._gameData.moneyNum,last:n})},t.subMoney=function(e){e=Math.ceil(e);var n=t._gameData.moneyNum;t._gameData.moneyNum-=e,t._gameData.moneyNum<0&&(t._gameData.moneyNum=0),a["default"].instance.dispatch(o.EventDef.Game_OnUserMoneyChange,{curr:t._gameData.moneyNum,last:n})},t.getMoney=function(){return t._gameData.moneyNum},t.addCrystal=function(e){e=Math.ceil(e);var n=t._gameData.crystalNum;t._gameData.crystalNum+=e,a["default"].instance.dispatch(o.EventDef.Game_OnUserCrystalChange,{curr:t._gameData.crystalNum,last:n})},t.subCrystal=function(e){e=Math.ceil(e);var n=t._gameData.crystalNum;t._gameData.crystalNum-=e,t._gameData.crystalNum<0&&(t._gameData.crystalNum=0),a["default"].instance.dispatch(o.EventDef.Game_OnUserCrystalChange,{curr:t._gameData.crystalNum,last:n})},t.getCrystal=function(){return t._gameData.crystalNum},t.getPassSong=function(){return t._gameData.unlockSongs},t.AddUnlockSong=function(e,n,a){void 0===n&&(n=0),void 0===a&&(a=0);for(var o=0;o<t._gameData.unlockSongs.length;o++){var i=t._gameData.unlockSongs[o];if(i.name==e)return}var s=new r;s.name=e,t._gameData.unlockSongs.push(s)},t.IncludetSong=function(e){for(var n=0;n<t._gameData.unlockSongs.length;n++){var a=t._gameData.unlockSongs[n];if(a.name==e)return!0}return!1},t.code="",t.openId="",t.token=null,t.nickName="",t.gender=0,t.isLogin=!1,t._gameData=new i,t}(Laya.Script);n["default"]=s},{"../Event/EventDef":4,"../Event/EventMgr":5}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){}return e.Lerp=function(e,t,n){if(e==t)return t;if(e>t){var a=e-n;return t>=a?t:a}if(t>e){var a=e+n;return a>=t?t:a}},e.lerpEulerAngle=function(t,n,a){var t=t%360;t=t>=0?t:360+t;var n=n%360;n=n>=0?n:360+n;var o=Math.abs(n-t);o>180&&(n>t?n-=360:t>n&&(n+=360));var i=e.Lerp(t,n,a);return i},e.getRotationByDir=function(t){var n=t.x*e.poinDown.x+t.y*e.poinDown.y,a=n/(t.distance(0,0)*e.poinDown.distance(0,0)),o=Math.acos(a),i=o/(2*Math.PI)*360;return t.x<0&&(i=-i),i},e.getRotationByDirOn3DSpace=function(t){var n=t.x*e.poinUp.x+t.y*e.poinUp.y,a=n/(t.distance(0,0)*e.poinUp.distance(0,0)),o=Math.acos(a),i=o/(2*Math.PI)*360;return t.x<0&&(i+=2*(180-i)),i},e.getDirByRotation=function(e){var t=(e-90)*Math.PI/180,n=Math.cos(t),a=Math.sin(t),o=new Laya.Point(n,a);return o.normalize(),o},e.getDirDirAngle=function(e,t){var n=e.x*t.x+e.y*t.y,a=n/(e.distance(0,0)*t.distance(0,0)),o=Math.acos(a),i=o/(2*Math.PI)*360;return i},e.getDirScalarLength=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return t},e.setSpOnParentCenter=function(e){if(null!=e.parent){var t=e.parent,n=0,a=0,n=n-e.width/2*e.scaleX+t.width/2,a=a-e.height/2*e.scaleY+t.height/2;e.x=n,e.y=a}},e.getPointToLineDistance=function(e,t,n,a){var o=new Laya.Point(e-n.x,t-n.y),i=new Laya.Point(e-a.x,t-a.y),r=new Laya.Point(a.x-n.y,a.y-n.y),s=r.x*o.x+r.y*o.y;if(0>=s)return o.distance(0,0);var l=r.x*i.x+r.y*i.y;if(0>=l)return i.distance(0,0);var u=o.distance(0,0),c=r.distance(0,0),h=s/(u*c),d=Math.acos(h),f=Math.sin(d)*u;return f},e.isIphoneX=function(){return Laya.Browser.onIPhone&&(2436==Laya.Browser.width&&1125==Laya.Browser.height||2436==Laya.Browser.height&&1125==Laya.Browser.width)?!0:!1},e.isIphone=function(){return Laya.Browser.onIPhone},e.getChild=function(t,n){for(var a=0;a<t.numChildren;++a){var o=t.getChildAt(a);if(o.name==n)return o;var i=e.getChild(o,n);if(i)return i}return null},e.FindChild=function(e,t){for(var n=t.split("/"),a=0;a<n.length;a++)if(t=n[a],e=e.getChildByName(t),null==e)return null;return e},e.GetRandomNumber=function(e,t){var n=t-e,a=Math.random();return e+Math.round(a*n)},e.OriginStageWidth=1334,e.OriginStageHeight=750,e.grayscaleMat=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0],e.grayscaleFilter=new Laya.ColorFilter(e.grayscaleMat),e.poinDown=new Laya.Point(0,-1),e.poinUp=new Laya.Point(0,1),e}();n["default"]=a},{}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Mgr/SoundMgr"),o=function(e){function t(){var t=e.call(this)||this;return t.use_myqq_Sound=!0,t}return __extends(t,e),t.prototype.onAwake=function(){this.owner.on(Laya.Event.MOUSE_DOWN,this,this.on_myqq_Down),this.owner.on(Laya.Event.MOUSE_UP,this,this.on_myqq_Up),this.owner.on(Laya.Event.MOUSE_OUT,this,this.on_myqq_Up)},t.prototype.onDisable=function(){this.owner.offAll(),Laya.Tween.clearAll(this)},t.prototype.on_myqq_Down=function(){Laya.Tween.to(this.owner,{scaleX:.9,scaleY:.9},50),this.use_myqq_Sound&&a["default"].instance.playSound("anniu")},t.prototype.on_myqq_Up=function(){Laya.Tween.to(this.owner,{scaleX:1,scaleY:1},50)},t}(Laya.Script);n["default"]=o},{"../Mgr/SoundMgr":27}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../ShareAd/View/BannerAdView"),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){this._ownerSprite=this.owner,this._autoZone=this._ownerSprite.getChildByName("AutoZone"),this._loopADZone=this._ownerSprite.getChildByName("LoopAD"),this._bannerADZone=this._ownerSprite.getChildByName("BannerAD"),this._bannerAd=this._bannerADZone.getComponent(a["default"])},t.prototype.onEnable=function(){var e=Laya.stage.width/Laya.stage.height;.5>e?(this._autoZone.bottom=this._loopADZone.height+this._bannerADZone.height,this._loopADZone.bottom=this._bannerADZone.height,this._bannerADZone.visible=!0):(this._autoZone.bottom=this._loopADZone.height,this._loopADZone.bottom=0,this._bannerADZone.visible=!1)},t.prototype.onDisable=function(){},t.prototype.onUpdate=function(){this._bannerADZone.visible||this._bannerAd.clearWXBaner()},t}(Laya.Script);n["default"]=o},{"../../ShareAd/View/BannerAdView":36}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../Utilit"),o=e("../../../Game/GameConst"),i=e("../../../Game/SoundManager"),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.newFlag=null,t.hotFlag=null,t.songName=null,t.selectFlag=null,t.background=null,t.starLevels=null,t.songData=null,t.clickHandler=null,t.timer=0,t}return __extends(t,e),t.prototype.onAwake=function(){this.newFlag=this.owner.getChildByName("NewFlag"),this.hotFlag=this.owner.getChildByName("HotFlag"),this.songName=a["default"].FindChild(this.owner,"SongName/Label"),this.selectFlag=this.owner.getChildByName("SelectFlag"),this.background=this.owner.getChildByName("Background"),this.starLevels=this.owner.getChildByName("StarLevels"),this.background.on(Laya.Event.CLICK,this,this.OnClickSong)},t.prototype.Reset=function(){this.clickHandler&&this.clickHandler.recover()},t.prototype.UpdateView=function(e,t){if(this.Reset(),null!=t){this.songData=t,this.songName.text="No."+(e+1)+" "+t.songName,this.hotFlag.visible=!1,this.newFlag.visible=!1,this.background.loadImage(o["default"].GetRandomSongPreviewPng);var n=t.previewPngs;if(0!=n.length){var r=n[a["default"].GetRandomNumber(0,n.length-1)];this.background.loadImage(r)}var s=i["default"].Instance.GetSongRecord(t.name),l=s?s.starLevel:0;this.SetStarLevel(l)}},t.prototype.ActiveSong=function(e){null!=this.songData&&(this.selectFlag.visible=e,Laya.Tween.clearAll(this.selectFlag),Laya.Tween.clearAll(this.background),e&&(this.selectFlag.alpha=0,Laya.Tween.to(this.selectFlag,{alpha:1},300),Laya.Tween.to(this.background,{rotation:this.background.rotation+3600},12e4)),this.AutoTextScroll(this.songName.textField,e))},t.prototype.SetStarLevel=function(e){for(var t=1;3>=t;t++){var n=this.starLevels.getChildByName("Star"+t),a=n.getChildByName("Active");a.visible=e>=t}},t.prototype.AutoTextScroll=function(e,t,n){void 0===n&&(n=5);var a=e.width,o=e.textWidth,i=o-a;t?(this.timer=0,Laya.timer.frameLoop(1,this,this.TextScroll,[e,a,i,n])):(e.scrollX=0,Laya.timer.clear(this,this.TextScroll))},t.prototype.TextScroll=function(e,t,n,a){e.scrollX=Math.sin(this.timer)*n,this.timer+=a*(Laya.timer.delta/1e4)},t.prototype.OnClickSong=function(){this.clickHandler&&this.clickHandler.runWith(this.songData)},t}(Laya.Script);n["default"]=r},{"../../../Game/GameConst":13,"../../../Game/SoundManager":19,"../../../Utilit":41}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../Utilit"),o=e("../../../Game/SoundManager"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.playHander=null,t.unlockHander=null,t}return __extends(t,e),t.prototype.onAwake=function(){this.songName=this.owner.getChildByName("SongName"),this.playButton=this.owner.getChildByName("PlayButton"),this.unlockAdButton=a["default"].FindChild(this.owner,"Operation/AdType"),this.unlocakPowerButton=a["default"].FindChild(this.owner,"Operation/PowerType"),this.record=a["default"].FindChild(this.owner,"Operation/Played"),this.selectFlag=a["default"].FindChild(this.owner,"Background/Selected"),this.starLevels=this.owner.getChildByName("StarLevels"),this.freeUnlockButton=a["default"].FindChild(this.owner,"Operation/Free")},t.prototype.UpdateView=function(e){this.songData=e,this.songName.text=e.name;var t=e.chargeType,n=o["default"].Instance.CheckSongIsFree(e),a=o["default"].Instance.CheckSongUnlocked(e.name);if(this.record.visible=a,this.freeUnlockButton.visible=n&&!a,this.unlockAdButton.visible=!n&&!a&&2==t,this.unlocakPowerButton.visible=!n&&!a&&1==t,a){var i=o["default"].Instance.GetSongRecord(e.name);this.SetStarLevel(i.starLevel)}else this.SetStarLevel(0);this.playHander&&this.playHander.recover(),this.unlockHander&&this.unlockHander.recover()},t.prototype.SetStarLevel=function(e){for(var t=1;3>=t;t++){var n=this.starLevels.getChildByName("Star"+t),a=n.getChildByName("Active");a.visible=e>=t}},t.prototype.ActiveSong=function(e){this.selectFlag.visible=e},t}(Laya.Script);n["default"]=i},{"../../../Game/SoundManager":19,"../../../Utilit":41}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._list=null,t._cellWidth=20,t._inDrag=!1,t._startOffset=0,t._hasChange=!1,t._centerIndex=-1,t._targetCenterIndex=0,t.sensitivity=.5,t.rollRatio=.95,t.moveSpeed=10,t.enabledMove=!1,t.cellStateChange=null,t.centerCellChange=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this.listBar.isVertical},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listBar",{get:function(){return this._list.scrollBar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CenterIndex",{get:function(){return this._centerIndex},enumerable:!0,configurable:!0}),t.prototype.onAwake=function(){this._list=this.owner,this._list.on(Laya.Event.RENDER,this,this.onListRenderHandler),this._list.on(Laya.Event.MOUSE_DOWN,this,this.onListMouseDown),this._list.on(Laya.Event.MOUSE_UP,this,this.onListMouseUp),this._list.on(Laya.Event.MOUSE_OUT,this,this.onListMouseUp),this.changeCells()},t.prototype.onEnable=function(){var e=this;Laya.timer.callLater(this,function(){e.UpdateCenterCell(e.AuteGetCenterIndex())})},t.prototype.onListRenderHandler=function(e,t){this.changeCells(),this.UpdateChildState(e)},t.prototype.changeCells=function(){var e=this._list.cells[0],t=e.width+this._list.spaceX||1,n=e.height+this._list.spaceY||1;this._cellWidth=this.isVertical?n:t,this._targetCenterIndex=this.GetCenterTargetIndex(this.listBar.value)},t.prototype.onListMouseDown=function(){this._inDrag=!0,this._startOffset=this.listBar.value,this._targetCenterIndex=this.GetCenterTargetIndex(this._startOffset),Laya.timer.frameLoop(1,this,this.onListCenterLoop,null,!0)},t.prototype.onListMouseUp=function(){this._inDrag=!1;var e=this.listBar.value;e+=(e-this._startOffset)*this.sensitivity,this._targetCenterIndex=this.GetCenterTargetIndex(e),Math.abs(e)>1&&(this._hasChange=!0),this.enabledMove||this.StopListMove()},t.prototype.UpdateChildState=function(e){e.scale(1,1);var t=new Laya.Point(0,0),n=e.localToGlobal(t,!1,this._list),a=0;a=this.isVertical?n.distance(n.x,0):n.distance(0,n.y);var o=1-Math.min(1,Math.abs(a)/this._list.width);this.cellStateChange&&this.cellStateChange.runWith([e,o])},t.prototype.GetCenterTargetIndex=function(e){var t=Math.floor(e/this._cellWidth);if(t>=this._list.length)return t;var n=Math.abs(e-t*this._cellWidth),a=Math.abs(e-(t+1)*this._cellWidth);return n>a&&t++,t},t.prototype.AuteGetCenterIndex=function(){return this.enabledMove?this.GetCenterTargetIndex(this.listBar.value):this._targetCenterIndex},t.prototype.StopListMove=function(){this._list.stopDrag(),this.listBar.stopScroll(),this.listBar.startTweenMoveForce(0)},t.prototype.onListCenterLoop=function(){for(var e=this._list.cells,t=0;t<e.length;t++)this.UpdateChildState(e[t]);var n=this.listBar.lastOffset,a=this.AuteGetCenterIndex(),o=a*this._cellWidth;if(!this._inDrag&&1==this._hasChange&&Math.abs(n)<Math.sqrt(this.moveSpeed)){var i=this.listBar.value;if(i=this.Lerp(i,o,1*this.moveSpeed/60),Math.abs(o-i)<2)return this._hasChange=!1,this.StopListMove(),this.listBar.value=o,this.UpdateCenterCell(a),this._targetCenterIndex=a,void Laya.timer.clear(this,this.onListCenterLoop);this.listBar.value=i}},t.prototype.UpdateCenterCell=function(e){if(this._centerIndex!=e){this._centerIndex=e;var t=this._list.getCell(this._centerIndex);this.centerCellChange&&this.centerCellChange.runWith([t,this._centerIndex])}},t.prototype.MoveTo=function(e){var t=this;e>this._list.array.length-1||(this._targetCenterIndex=e,this._list.scrollTo(e),Laya.timer.frameOnce(5,this,function(){t.UpdateCenterCell(e);for(var n=0;n<t._list.cells.length;n++)t.UpdateChildState(t._list.cells[n])}))},t.prototype.Lerp=function(e,t,n){return e+n*(t-e)},t}(Laya.Script);n["default"]=a},{}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=e("../../Mgr/ViewMgr"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){this.backButton=this.owner.getChildByName("BackButton"),this.backButton.on(Laya.Event.CLICK,this,this.OnClickBack)},t.prototype.OnClickBack=function(){var e=this;o["default"].instance.openView(o.ViewDef.GameMainView,null,function(){e.closeView()})},t}(a["default"]);n["default"]=i},{"../../Mgr/ViewMgr":29,"../ViewBase":57}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=e("../../Game/GameController"),i=e("../../Mgr/ViewMgr"),r=e("../../NativeCallback"),s=e("../../Event/EventMgr"),l=e("../../Event/EventDef"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){this.skipBtn=this.owner.getChildByName("SkipBtn"),this.resurgenceBtn=this.owner.getChildByName("ResurgenceBtn"),this.skipBtn.on(Laya.Event.CLICK,this,this.onClickSkip),this.resurgenceBtn.on(Laya.Event.CLICK,this,this.onClickResurgence)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),s["default"].instance.regEvemt(l.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),s["default"].instance.regEvemt(l.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess)},t.prototype.onClickSkip=function(){console.log("跳过激励视频复活"),this.closeView(),o["default"].Instance.GameOver()},t.prototype.onRewardVidewoFail=function(){i["default"].instance.openView(i.ViewDef.TipsView,"Video playback failed. Resurrection failed"),this.closeView(),o["default"].Instance.GameOver()},t.prototype.onRewardVidewoSuccess=function(){this.closeView(),o["default"].Instance.ResurrectionGame()},t.prototype.onClickResurgence=function(){console.log("激励视频复活准备"),Laya.Browser.onAndroid||Laya.Browser.onIOS?(r["default"].CallNativeFunc("showRewardVideo"),Laya.SoundManager.muted=!0):(this.closeView(),o["default"].Instance.ResurrectionGame())},t.prototype.onDisable=function(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this),s["default"].instance.removeEvent(l.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),s["default"].instance.removeEvent(l.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess)},t}(a["default"]);n["default"]=u},{"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../Game/GameController":14,"../../Mgr/ViewMgr":29,"../../NativeCallback":30,"../ViewBase":57}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../TextureProcessBar"),o=e("../ViewBase"),i=e("../../Game/GameController"),r=e("../../Mgr/ViewMgr"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.curLoadSongName=null,t.completed=null,t.processBar=null,t}return __extends(t,e),t.prototype.onAwake=function(){this.processBar=this.owner.getChildByName("ProcessBar").getComponent(a["default"])},t.prototype.show=function(){this.processBar.setValue(0,0),this.curLoadSongName=this._data,this.LoadSong()},t.prototype.LoadSong=function(){var e=this;Laya.timer.clearAll(this),i["default"].Instance.GameReady(this.curLoadSongName,Laya.Handler.create(this,function(e){console.log("Song Load Succeed")}),Laya.Handler.create(this,function(t){console.log("Process:"+t),e.processBar.setValue(t)})),this.completed=Laya.Handler.create(this,function(){r["default"].instance.openView(r.ViewDef.GameWorkView,null,function(){e.closeView()})}),Laya.timer.frameLoop(20,this,function(){1==e.processBar.CurrentValue&&null!=e.completed&&(e.completed.run(),e.ClearHander())})},t.prototype.ClearHander=function(){Laya.timer.clearAll(this),null!=this.completed&&(this.completed.recover(),this.completed=null)},t.prototype.onDisable=function(){this.ClearHander(),Laya.Tween.clearAll(this),Laya.timer.clearAll(this)},t}(o["default"]);n["default"]=s},{"../../Game/GameController":14,"../../Mgr/ViewMgr":29,"../TextureProcessBar":55,"../ViewBase":57}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../Mgr/ViewMgr"),o=e("../ViewBase"),i=e("../../Game/Version"),r=e("./CenterList"),s=e("../../Utilit"),l=e("../../User/User"),u=e("../../WXAPI"),c=e("../../Game/SoundManager"),h=e("./CellView/SongDisCell"),d=e("../../Event/EventMgr"),f=e("../../Event/EventDef"),p=e("../../NativeCallback"),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){this.songList=this.owner.getChildByName("SongList"),this.centerList=this.songList.getComponent(r["default"]),this.playButton=this.owner.getChildByName("PlayButton"),this.shardButton=this.owner.getChildByName("ShareButton"),this.rankButton=this.owner.getChildByName("RankButton"),this.storeButton=this.owner.getChildByName("SongStore"),this.NewSongFlag=this.storeButton.getChildByName("NewSong"),this.shardButton.visible=!1,this.rankButton.visible=!1,this.physicalValues=s["default"].FindChild(this.owner,"PhysicalValue/Label"),this.physicals=this.playButton.getChildByName("Box"),this.powerFlag=this.playButton.getChildByName("Power"),this.videoFlag=this.playButton.getChildByName("Video"),this.noPhysical=this.playButton.getChildByName("NoPhysical"),this.castLabel=this.powerFlag.getChildByName("Label"),this.songList.hScrollBarSkin="",this.songList.selectEnable=!1,this.songList.elasticEnabled=!0,this.songList.renderHandler=Laya.Handler.create(this,this.OnRenderSongList,null,!1),this.centerList.cellStateChange=Laya.Handler.create(this,this.OnCellStateChange,null,!1),this.centerList.centerCellChange=Laya.Handler.create(this,this.OnCenterChange,null,!1),this.playButton.on(Laya.Event.CLICK,this,this.OnClickPlayButton),this.shardButton.on(Laya.Event.CLICK,this,this.OnClickShareButton),this.storeButton.on(Laya.Event.CLICK,this,this.OnClickStoreButton),this.rankButton.on(Laya.Event.CLICK,this,this.OnClickRankButton)},t.prototype.onEnable=function(){console.log(i["default"].songs.length),this.songList.array=i["default"].songs,this.physicalValues.text=l["default"].getMoney().toString();var e=c["default"].Instance.GetLastPlaySongIndex();this.centerList.MoveTo(e),d["default"].instance.regEvemt(f.EventDef.Game_OnUserMoneyChange,this,this.OnMoneyChange),d["default"].instance.regEvemt(f.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),d["default"].instance.regEvemt(f.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess);var t=i["default"].songs[e],n=t.chargeType,a=c["default"].Instance.CanPlayOne();a?(this.noPhysical.visible=!1,this.videoFlag.visible=n==i.ChargeType.Video,this.powerFlag.visible=n==i.ChargeType.Power||n==i.ChargeType.Free):(this.noPhysical.visible=!0,this.videoFlag.visible=!0,this.powerFlag.visible=!1)},t.prototype.onDisable=function(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this),d["default"].instance.removeEvent(f.EventDef.Game_OnUserMoneyChange,this,this.OnMoneyChange),d["default"].instance.removeEvent(f.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),d["default"].instance.removeEvent(f.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess)},t.prototype.onRewardVidewoFail=function(){"ClickPlay"==p["default"].NowVideoType&&(this.playButton.mouseEnabled=!0),a["default"].instance.openView(a.ViewDef.TipsView,"Video playback failed. can't enter game")},t.prototype.onRewardVidewoSuccess=function(){var e=i["default"].songs;if(null==e||0==e.length)return void a["default"].instance.openView(a.ViewDef.TipsView,"The library is empty and is being expedited ... ...");var t=e[this.centerList.CenterIndex];"ClickSong"==p["default"].NowVideoType&&null!=this.clickSong&&(t=this.clickSong),this.PlaySong(t),Laya.timer.clearAll(this),this.playButton.mouseEnabled=!0},t.prototype.OnClickPlayButton=function(){var e=this,t=i["default"].songs;if(null==t||0==t.length)return void a["default"].instance.openView(a.ViewDef.TipsView,"The library is empty and is being expedited ... ...");if((Laya.Browser.onAndroid||Laya.Browser.onIOS)&&!c["default"].Instance.CanPlayOne())return p["default"].NowVideoType="ClickPlay",p["default"].CallNativeFunc("showRewardVideo"),Laya.SoundManager.muted=!0,void(this.playButton.mouseEnabled=!1);var n=t[this.centerList.CenterIndex];if(!c["default"].Instance.CanPlayOne())return this.PlaySong(n),Laya.timer.clearAll(this),this.playButton.mouseEnabled=!1,void Laya.timer.once(1e3,this,function(){e.playButton.mouseEnabled=!0});this.playButton.mouseEnabled=!1,Laya.timer.clearAll(this),Laya.timer.once(1e3,this,function(){e.playButton.mouseEnabled=!0,e.PlaySong(n)}),this.physicalValues.text=(l["default"].getMoney()-c["default"].Instance.GetSongCastMoney(n)).toString();var o=s["default"].FindChild(this.playButton,"Power/Logo"),r=this.physicalValues.parent.localToGlobal(new Laya.Point),u=o.localToGlobal(new Laya.Point);this.ShowPhysicalAnim(this.physicals,o,r,u,300)},t.prototype.ShowPhysicalAnim=function(e,t,n,a,o){var i=this;n=e.globalToLocal(n),a=e.globalToLocal(a);for(var r=function(){Laya.Tween.clearAll(t),t.scale(1,1),Laya.Tween.from(t,{scaleX:1.4,scaleY:1.4},200,Laya.Ease.backOut)},l=function(t){var l=e._children[t];l.x=n.x,l.y=n.y,l.visible=!0,Laya.Tween.clearAll(u),Laya.Tween.to(l,{x:n.x+s["default"].GetRandomNumber(0,o),y:n.y+s["default"].GetRandomNumber(0,o)},150,null,Laya.Handler.create(u,function(){Laya.Tween.to(l,{x:a.x,y:a.y},1e3*(.2+.3*Math.random()),null,Laya.Handler.create(i,function(){l.visible=!1,r.call(i)}))}))},u=this,c=0;c<e._children.length;c++)l(c)},t.prototype.OnClickShareButton=function(){u["default"].share(function(e){console.log(e?"分享成功":"用户取消")},"魔音球球， 快一起来玩呀！","")},t.prototype.OnClickRankButton=function(){a["default"].instance.openView(a.ViewDef.TipsView,"功能正在完善中。。。")},t.prototype.OnClickStoreButton=function(){var e=this;a["default"].instance.openView(a.ViewDef.SongStoreView,this.centerList.CenterIndex,function(){e.closeView()})},t.prototype.OnRenderSongList=function(e,t){var n=this.songList.array[t],a=e.getComponent(h["default"]);a.UpdateView(t,n),a.clickHandler=Laya.Handler.create(this,this.OnClickSong,null,!1)},t.prototype.OnCenterChange=function(e,t){for(var n=this.songList.cells,a=0;a<n.length;a++){var o=n[a],i=n[a].getComponent(h["default"]),r=o==e;i.ActiveSong(r)}var s=this.songList.array[t];c["default"].Instance.AuditionSong(s),this.castLabel.text="×"+c["default"].Instance.GetSongCastMoney(s)},t.prototype.OnClickSong=function(e){return!Laya.Browser.onAndroid&&!Laya.Browser.onIOS||c["default"].Instance.CanPlayOne()?void this.PlaySong(e):(p["default"].NowVideoType="ClickSong",p["default"].CallNativeFunc("showRewardVideo"),Laya.SoundManager.muted=!0,void(this.clickSong=e))},t.prototype.PlaySong=function(e){var t=this;c["default"].Instance.PlaySong(e,this,function(){t.closeView()})},t.prototype.OnCellStateChange=function(e,t){var n=1,a=Math.min(n,.6+.4*t);e.scale(a,a)},t.prototype.OnMoneyChange=function(e){var t=e.curr;this.physicalValues.text=t.toString()},t}(o["default"]);n["default"]=g},{"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../Game/SoundManager":19,"../../Game/Version":23,"../../Mgr/ViewMgr":29,"../../NativeCallback":30,"../../User/User":40,"../../Utilit":41,"../../WXAPI":58,"../ViewBase":57,"./CellView/SongDisCell":44,"./CenterList":46}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=e("../../Mgr/ViewMgr"),i=e("../../Game/GameController"),r=e("../../Utilit"),s=e("../../Game/SoundManager"),l=e("../../User/User"),u=e("../../Event/EventDef"),c=e("../../NativeCallback"),h=e("../../Event/EventMgr"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._songName=null,t._songSource=null,t._energy=null,t._energyLabel=null,t._physicalBox=null,t._physicalValue=null,t._skipButton=null,t._adMultipleNum=null,t._adReceiveButton=null,t._freeReceiveButton=null,t._currentPassSong=null,t}return __extends(t,e),t.prototype.onAwake=function(){this._energy=this.owner.getChildByName("Energy"),this._energyLabel=this._energy.getChildByName("Label"),this._stars=r["default"].FindChild(this.owner,"StartBox/Stars"),this._songName=r["default"].FindChild(this.owner,"SongName/Label"),this._songSource=r["default"].FindChild(this.owner,"Source/Label"),this._skipButton=this.owner.getChildByName("SkipBtn"),this._adReceiveButton=this.owner.getChildByName("AdResurgenceBtn"),this._adMultipleNum=this.owner.getChildByName("Label"),this._freeReceiveButton=this.owner.getChildByName("FreeResurgenceBtn"),this._physicalBox=r["default"].FindChild(this.owner,"PhysicalValue/Box"),this._physicalValue=r["default"].FindChild(this.owner,"PhysicalValue/Label"),this._skipButton.on(Laya.Event.CLICK,this,this.onClickFreeReceive),this._freeReceiveButton.on(Laya.Event.CLICK,this,this.onClickFreeReceive),this._adReceiveButton.on(Laya.Event.CLICK,this,this.onClickAdReceive)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),h["default"].instance.regEvemt(u.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),h["default"].instance.regEvemt(u.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess),h["default"].instance.regEvemt(u.EventDef.InsertVideoEnd,this,this.onInsertVideoEnd)},t.prototype.onShow=function(){var e=this._data,t=i["default"].Instance.GetCurrentSongRecord(),n=t.name,a=t.starLevel,o=t.source;this._currentPassSong=t,this._songName.text=n,this._songSource.text=o.toString(),this._physicalValue.text=l["default"].getMoney().toString(),this.SetStar(a),this._energyLabel.value=s["default"].Instance.GetSongAwards(e,a).toString(),this._adReceiveButton.visible=e,this._freeReceiveButton.visible=!e},t.prototype.SetStar=function(e){var t=this;this._stars._children.forEach(function(e){e.visible=!1}),Laya.timer.once(300,this,function(){for(var n=function(n){var a=t._stars.getChildByName("Star"+n);if(e>=n){var o=.2*(n-1)*1e3;Laya.timer.once(o,t,function(){a.visible=!0,a.scale(1,1),Laya.Tween.from(a.alpha,{alpha:.01},100),Laya.Tween.from(a,{scaleX:4,scaleY:4},300,Laya.Ease.backOut)})}},a=1;3>=a;a++)n(a)})},t.prototype.onRewardVidewoFail=function(){o["default"].instance.openView(o.ViewDef.TipsView,"Get reward after watch the video")},t.prototype.onRewardVidewoSuccess=function(){
var e=s["default"].Instance.SetAdSongAwards(this._currentPassSong.starLevel);this._physicalValue.text=e.toString(),this.ShowGetPowerEffect(this._adReceiveButton)},t.prototype.onClickAdReceive=function(e){if(console.log("倍数领取奖励"),Laya.Browser.onAndroid||Laya.Browser.onIOS)c["default"].CallNativeFunc("showRewardVideo"),Laya.SoundManager.muted=!0;else{var t=s["default"].Instance.SetAdSongAwards(this._currentPassSong.starLevel);this._physicalValue.text=t.toString(),this.ShowGetPowerEffect(e.target)}},t.prototype.onClickFreeReceive=function(e){console.log("免费领取"),this._physicalValue.text=s["default"].Instance.SetFreeSongAwards().toString(),this.ShowGetPowerEffect(e.target)},t.prototype.ShowGetPowerEffect=function(e){var t=this;e.mouseEnabled=!1,Laya.timer.once(1e3,this,function(){o["default"].instance.openView(o.ViewDef.GameMainView,null,function(){t.closeView()})});var n=this._energy.localToGlobal(new Laya.Point(this._energy.width/2,this._energy.height/2)),a=this._physicalBox.localToGlobal(new Laya.Point(0,0)),i=this._physicalValue.parent.getChildByName("Logo");this.ShowPhysicalAnim(this._physicalBox,i,n,a,300)},t.prototype.onInsertVideoEnd=function(){var e=this;o["default"].instance.openView(o.ViewDef.GameMainView,null,function(){e.closeView()}),Laya.SoundManager.muted=!0,c["default"].CallNativeFunc("loadNextAd")},t.prototype.ShowPhysicalAnim=function(e,t,n,a,o){var i=this;n=e.globalToLocal(n),a=e.globalToLocal(a);for(var s=function(){Laya.Tween.clearAll(t),t.scale(1,1),Laya.Tween.from(t,{scaleX:1.4,scaleY:1.4},200,Laya.Ease.backOut)},l=function(t){var l=e._children[t];l.x=n.x,l.y=n.y,l.visible=!0,Laya.Tween.clearAll(u),Laya.Tween.to(l,{x:n.x+r["default"].GetRandomNumber(-o,o),y:n.y+r["default"].GetRandomNumber(-o,o)},150,null,Laya.Handler.create(u,function(){Laya.Tween.to(l,{x:a.x,y:a.y},1e3*(.2+.3*Math.random()),null,Laya.Handler.create(i,function(){l.visible=!1,s.call(i)}))}))},u=this,c=0;c<e._children.length;c++)l(c)},t.prototype.onDisable=function(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this),h["default"].instance.removeEvent(u.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),h["default"].instance.removeEvent(u.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess)},t}(a["default"]);n["default"]=d},{"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../Game/GameController":14,"../../Game/SoundManager":19,"../../Mgr/ViewMgr":29,"../../NativeCallback":30,"../../User/User":40,"../../Utilit":41,"../ViewBase":57}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=e("../../Game/GameController"),i=e("../../Event/EventMgr"),r=e("../../Event/EventDef"),s=e("../../Utilit"),l=e("../../Mgr/ViewMgr"),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.progressBar=null,t}return __extends(t,e),t.prototype.onAwake=function(){this.touchTip=this.owner.getChildByName("Touch"),this.playTip=this.owner.getChildByName("ContinuePlay");var e=this.owner.getChildByName("ProgressBar");this.progressBar=new c(e),this.playStateFlags=this.owner.getChildByName("PlayStateFlags"),this.songName=s["default"].FindChild(this.owner,"SongName/Label"),this.songSource=this.owner.getChildByName("SongSource"),this.perfectCount=this.owner.getChildByName("PerfectCount")},t.prototype.onShow=function(){this.Reset(),this.ShowGamePlay(),this.songName.text=o["default"].Instance.currentSong.songName},t.prototype.Reset=function(){this.songName.text="",this.songSource.value="0",this.progressBar.Reset(),this.playTip.visible=!1,this.touchTip.visible=!1,this.playStateFlags.visible=!1},t.prototype.onEnable=function(){i["default"].instance.regEvemt(r.EventDef.Game_Failure,this,this.OnGameFailure),i["default"].instance.regEvemt(r.EventDef.Game_Resurgence,this,this.onPlayResurgence),i["default"].instance.regEvemt(r.EventDef.Game_Settle,this,this.onGamePlayState),i["default"].instance.regEvemt(r.EventDef.Game_StateChange,this,this.OnGameStateChange),i["default"].instance.regEvemt(r.EventDef.Game_SongSourceChange,this,this.onSourceChange)},t.prototype.onDisable=function(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this),i["default"].instance.removeEvent(r.EventDef.Game_Failure,this,this.OnGameFailure),i["default"].instance.removeEvent(r.EventDef.Game_Settle,this,this.onGamePlayState),i["default"].instance.removeEvent(r.EventDef.Game_Resurgence,this,this.onPlayResurgence),i["default"].instance.removeEvent(r.EventDef.Game_StateChange,this,this.OnGameStateChange),i["default"].instance.removeEvent(r.EventDef.Game_SongSourceChange,this,this.onSourceChange)},t.prototype.ShowPerfectCount=function(e){var t=this.perfectCount.getChildByName("Label");t.value=e,this.perfectCount.visible=!0,Laya.timer.once(1e3,this,this.closePerfectCount),Laya.Tween.clearAll(this.perfectCount),Laya.Tween.from(this.perfectCount,{scaleX:1,scaleY:1},200,Laya.Ease.backOut)},t.prototype.closePerfectCount=function(){this.perfectCount.visible=!1},t.prototype.onSourceChange=function(e,t,n){this.songSource.value=e,this.progressBar.UpdateValue(Math.min(1,t)),3>n||this.ShowPerfectCount(n)},t.prototype.onGamePlayState=function(e){var t=this,n=this;this.playStateFlags.visible=!0;var a=this.playStateFlags.getChildByName("Win"),o=this.playStateFlags.getChildByName("Defeated");a.visible=e,o.visible=!e,Laya.Tween.clearAll(this.playStateFlags),Laya.Tween.from(this.playStateFlags,{y:0},700,Laya.Ease.backOut,Laya.Handler.create(this,function(){Laya.timer.once(500,t,function(){l["default"].instance.openView(l.ViewDef.GameSettleView,e,function(){n.closeView()})})})),this.touchTip.visible=!1,this.playTip.visible=!1},t.prototype.OnGameFailure=function(){Laya.timer.once(1e3,this,function(){l["default"].instance.openView(l.ViewDef.GameFailureView)})},t.prototype.onPlayResurgence=function(){this.playStateFlags.visible=!1,this.ShowGamePlay()},t.prototype.ShowGamePlay=function(){this.touchTip.visible=!0,Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnClickGamePlay)},t.prototype.OnClickGamePlay=function(){console.log("onGamePlay"),this.touchTip.visible=!1,o["default"].Instance.isGameing?o["default"].Instance.BallRun():o["default"].Instance.GamePlay(),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnClickGamePlay)},t.prototype.OnGameStateChange=function(e){e||(Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnClickResumeGame),this.ShowGamePause())},t.prototype.ShowGamePause=function(){this.playTip.visible=!0,this.touchTip.visible=!0,o["default"].Instance.PauseGame(),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnClickResumeGame)},t.prototype.OnClickResumeGame=function(){console.log("onGameResume"),this.playTip.visible=!1,this.touchTip.visible=!1,o["default"].Instance.ResumeGame(),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnClickResumeGame)},t.prototype.onKeyDown=function(e){e.keyCode==Laya.Keyboard.Q?o["default"].Instance.PauseGame():o["default"].Instance.ResumeGame()},t}(a["default"]);n["default"]=u;var c=function(){function e(e){this.progress=e.getChildByName("Progress"),this.minLeft=this.progress.left,this.minRight=this.progress.right,this.length=e.width-this.progress.left}return e.prototype.UpdateValue=function(e){this.progress.right=this.length-this.length*e,this.progress.right<this.minRight&&(this.progress.right=this.minRight),this.progress.left<this.minLeft&&(this.progress.left=this.minLeft)},e.prototype.Reset=function(){this.progress.left=this.minLeft,this.progress.right=this.length},e}()},{"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../Game/GameController":14,"../../Mgr/ViewMgr":29,"../../Utilit":41,"../ViewBase":57}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=e("../../Game/Version"),i=e("../../Utilit"),r=e("../../Mgr/ViewMgr"),s=e("../../Game/SoundManager"),l=e("./CellView/SongStoreCell"),u=e("../../NativeCallback"),c=e("../../Event/EventMgr"),h=e("../../Event/EventDef"),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){this.songList=this.owner.getChildByName("SongList"),this.currSongBox=this.owner.getChildByName("CurrSongData"),this.backButton=this.owner.getChildByName("BackButton"),this.songList.vScrollBarSkin="",this.songList.selectEnable=!0,this.songList.elasticEnabled=!0,this.songList.selectHandler=Laya.Handler.create(this,this.OnSelectSong,null,!1),this.songList.renderHandler=Laya.Handler.create(this,this.OnRenderSongList,null,!1),this.backButton.on(Laya.Event.CLICK,this,this.OnClickBackButton)},t.prototype.onEnable=function(){c["default"].instance.regEvemt(h.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),c["default"].instance.regEvemt(h.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess)},t.prototype.onShow=function(){var e=s["default"].Instance.GetLastPlaySongIndex();this.selectIndex=e;var t=o["default"].songs[e];this.SetCurrSongData(t),this.songList.array=o["default"].songs},t.prototype.SetCurrSongData=function(e){var t=i["default"].FindChild(this.currSongBox,"Name/Label"),n=this.currSongBox.getChildByName("StarLevels");t.text=e.name;for(var a=s["default"].Instance.GetSongRecord(e.name),o=null==a?0:a.starLevel,r=1;3>=r;r++){var l=n.getChildByName("Star"+r),u=l.getChildByName("Active");u.visible=o>=r}},t.prototype.OnRenderSongList=function(e,t){var n=this.songList.array[t],a=e.getComponent(l["default"]);a.UpdateView(n),a.ActiveSong(t==this.selectIndex),e.off(Laya.Event.CLICK,this,this.OnClickPlay),e.on(Laya.Event.CLICK,this,this.OnClickPlay)},t.prototype.OnSelectSong=function(e){var t=this.songList.cells,n=this.songList.array[e],a=this.songList.getCell(e);s["default"].Instance.AuditionSong(n);for(var o=0;o<t.length;o++){var i=t[o],r=t[o].getComponent(l["default"]);r.ActiveSong(i==a)}},t.prototype.OnClickPlay=function(){var e=this;if((Laya.Browser.onAndroid||Laya.Browser.onIOS)&&!s["default"].Instance.CanPlayOne())return u["default"].NowVideoType="StoreSong",u["default"].CallNativeFunc("showRewardVideo"),void(Laya.SoundManager.muted=!0);if(this.selectIndex!=this.songList.selectedIndex)return this.selectIndex=this.songList.selectedIndex,void this.SetCurrSongData(this.songList.array[this.selectIndex]);var t=this.songList.array[this.selectIndex];s["default"].Instance.PlaySong(t,this,function(){e.closeView()})},t.prototype.onRewardVidewoFail=function(){"StoreSong"==u["default"].NowVideoType&&r["default"].instance.openView(r.ViewDef.TipsView,"Video playback failed. can't enter game")},t.prototype.onRewardVidewoSuccess=function(){var e=this;if(this.selectIndex!=this.songList.selectedIndex)return this.selectIndex=this.songList.selectedIndex,void this.SetCurrSongData(this.songList.array[this.selectIndex]);var t=this.songList.array[this.selectIndex];s["default"].Instance.PlaySong(t,this,function(){e.closeView()})},t.prototype.OnClickUnlock=function(){this.songList.refresh()},t.prototype.OnClickBackButton=function(){var e=this;r["default"].instance.openView(r.ViewDef.GameMainView,null,function(){e.closeView()})},t.prototype.onDisable=function(){c["default"].instance.removeEvent(h.EventDef.RewardVideoFail,this,this.onRewardVidewoFail),c["default"].instance.removeEvent(h.EventDef.RewardVideoSuccess,this,this.onRewardVidewoSuccess)},t}(a["default"]);n["default"]=d},{"../../Event/EventDef":4,"../../Event/EventMgr":5,"../../Game/SoundManager":19,"../../Game/Version":23,"../../Mgr/ViewMgr":29,"../../NativeCallback":30,"../../Utilit":41,"../ViewBase":57,"./CellView/SongStoreCell":45}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._processWidth=0,t}return __extends(t,e),t.prototype.onAwake=function(){this._bg=this.owner.getChildByName("Bg"),this._processBarBg=this._bg.getChildByName("processBarBg"),this._processBarBg?(this._value=this._processBarBg.getChildByName("Value"),this._processBar=this._processBarBg.getChildByName("processBar"),this._processWidth=this._processBar.width):(this._processBar=this._bg.getChildByName("processBar"),this._processWidth=Laya.stage.width)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.addEvent=function(){e.prototype.addEvent.call(this)},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this)},t.prototype.onUpdate=function(){this._bg.width=Laya.stage.width,this._bg.height=Laya.stage.height,this._processBarBg||(this._processWidth=Laya.stage.width)},t.prototype.setProcess=function(e){0>e&&(e=0),e>1&&(e=1);var t=this._processWidth*e;1>t&&(t=1),this._processBar.width=t;var n=Math.min(Math.max(0,e),1);0>n&&(n=0),this._value.text=100*n+"%"},t}(a["default"]);n["default"]=o},{"../ViewBase":57}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resType="",t.soomthSpeed=5,t._value=0,t._curValue=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"CurrentValue",{get:function(){return this._curValue},enumerable:!0,configurable:!0}),t.prototype.onAwake=function(){this._image=this.owner},t.prototype.onEnable=function(){var e=this;this._texture=Laya.loader.getRes(this.resType),null==this._texture&&Laya.loader.load(this.resType,Laya.Handler.create(this,function(){e._texture=Laya.loader.getRes(e.resType)}),null,Laya.Loader.IMAGE,1)},t.prototype.onUpdate=function(){this._curValue=this.Lerp(this._curValue,this._value,1/60*this.soomthSpeed),1-this._curValue<=.01&&(this._curValue=1),this.draw(this._curValue)},t.prototype.Lerp=function(e,t,n){return e+n*(t-e)},t.prototype.setValue=function(e,t){void 0===t&&(t=null),this._value=e,this._value>1&&(this._value=1),null!=t&&(this._curValue=t)},t.prototype.draw=function(e){if(null!=this._texture){var t=0,n=0,a=this._image.height,o=this._image.width*e;this._image.graphics.clear(),this._image.graphics.fillTexture(this._texture,t,n,o,a,"no-repeat")}},t.prototype.getTexture=function(e,t,n,a,o){0>=a&&(a=1),0>=o&&(o=1),e.$_GID||(e.$_GID=Laya.Utils.getGID());var i;return i&&i._getSource()||(i=Laya.Texture.create(e.bitmap,t,n,a,o,0,0,e.width,e.height),i.width=a,i.height=o),i},t}(Laya.Script);n["default"]=a},{}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ViewBase"),o=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onAwake=function(){this._bg=this.owner.getChildByName("Bg"),this._bg.x=Laya.stage.width/2-this._bg.width/2,this._tipsText=this._bg.getChildByName("Text")},t.prototype.openView=function(t){e.prototype.openView.call(this,t),this.set_myqq_TipsMsg(t),Laya.timer.clearAll(this);var n=this;Laya.timer.once(3e3,this,function(){n.closeView()}),Laya.stage.setChildIndex(this.owner,Laya.stage._children.length-1)},t.prototype.set_myqq_TipsMsg=function(e){this._tipsText.text=e},t}(a["default"]);n["default"]=o},{"../ViewBase":57}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Mgr/ViewMgr"),o=e("../Event/EventMgr"),i=e("../Event/EventDef"),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCloseEvent=null,t.onOpenEvent=null,t._viewBase=!0,t._viewDef=a.ViewDef.None,t._data={},t}return __extends(t,e),t.prototype.onAwake=function(){this.owner.autoDestroyAtClosed=!0,this.owner.height=Laya.stage.height},t.prototype.onEnable=function(){this.addEvent()},t.prototype.onDisable=function(){this.removeEvent()},t.prototype.onDestroy=function(){this.removeEvent()},t.prototype.openView=function(e){this._data=e,this.show(),o["default"].instance.dispatch(i.EventDef.Game_OnViewOpen,{view:this._viewDef}),this.onOpenEvent&&this.onOpenEvent()},t.prototype.addEvent=function(){},t.prototype.removeEvent=function(){Laya.timer.clearAll(this)},t.prototype.closeView=function(){a["default"].instance.closeView(this._viewDef)},t.prototype.hide=function(){this.owner.visible=!1,this.onHide()},t.prototype.show=function(){this.owner.visible=!0,this.onShow()},t.prototype.viewIsHide=function(){return 0==this.owner.alpha},t.prototype.onHide=function(){},t.prototype.onShow=function(){},t.prototype.onClose=function(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),o["default"].instance.dispatch(i.EventDef.Game_OnViewClose,{view:this._viewDef}),this.onCloseEvent&&this.onCloseEvent()},t}(Laya.Script);n["default"]=r},{"../Event/EventDef":4,"../Event/EventMgr":5,"../Mgr/ViewMgr":29}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){}return e.wxLogin=function(e,t){Laya.Browser.onMiniGame&&Laya.Browser.window.wx.login({success:function(t){if(t.code){var n=t.code;e(n),console.log("登陆成功,获取到code : "+n)}}})},e.onRewardedVideoAdLoad=function(){console.log("激励视频 广告加载完成")},e.onRewardedVideoAdError=function(t){console.log("激励视频 广告加载失败"+t),e._onRewardedVideoAdFailed&&e._onRewardedVideoAdFailed()},e.onRewardedVideoAdClose=function(t){t&&t.isEnded||null==t?(console.log("激励视频 已完整观看"),e._onRewardedVideoAdClose&&e._onRewardedVideoAdClose(!0)):(console.log("激励视频 未完整观看"),e._onRewardedVideoAdClose&&e._onRewardedVideoAdClose(!1))},e.regRewardedVideoAdEvent=function(t){t.onLoad(e.onRewardedVideoAdLoad),t.onError(e.onRewardedVideoAdError),t.onClose(e.onRewardedVideoAdClose),e._isRegRewardedVideoAdEvent=!0},e.showRewardedVideoAd=function(t,n){if(Laya.Browser.onMiniGame){e._onRewardedVideoAdClose=t,e._onRewardedVideoAdFailed=n;var a=Laya.Browser.window.wx.createRewardedVideoAd({adUnitId:e.adUnitId});e._isRegRewardedVideoAdEvent||e.regRewardedVideoAdEvent(a),a.load().then(function(){var e=a.show();e.then(function(){return console.log("激励视频 广告显示成功")}),e["catch"](function(e){a.load().then(function(){return a.show()})["catch"](function(e){console.log("激励视频 广告显示失败"),n&&n()})})})["catch"](function(e){console.log("激励视频 广告加载失败"),n&&n()})}else t(!0)},e.navigateToMiniProgram=function(e,t,n,a,o){Laya.Browser.onMiniGame&&(console.log("跳转游戏： "+e),Laya.Browser.window.wx.navigateToMiniProgram({appId:e,path:t,extraData:{foo:"bar"},envVersion:"release",success:function(e){n&&n(e)},fail:function(e){a&&a(e)},complete:function(e){o&&o(e)}}))},e.share=function(t,n,a){var o=this;Laya.Browser.onMiniGame&&(e._onShow=function(){Laya.Browser.window.wx.offShow(e._onShow),e._onShow=null;Date.now()-o._lastShareTime;t&&t(Date.now()-o._lastShareTime>2e3?!0:!1)},Laya.Browser.window.wx.onShow(e._onShow),this._lastShareTime=Date.now(),Laya.Browser.window.wx.shareAppMessage({title:n,imageUrl:a}))},e.showInterstitialAd=function(t,n){if(Laya.Browser.onMiniGame){var a=Laya.Browser.window.wx.createInterstitialAd({adUnitId:e.InsAdUnitId});a.onLoad(function(){console.log("插屏广告 加载完成"),a.show()["catch"](function(e){console.log("插屏广告 显示失败 ："+e),n&&n()})}),a.onError(function(e){console.log("插屏广告 加载失败"+e),n&&n()}),a.onClose(function(){console.log("插屏广告 关闭"),t&&t()})}else t()},e.getLaunchOptionsSync=function(){if(Laya.Browser.onMiniGame){var e=Laya.Browser.window.wx.getLaunchOptionsSync();console.log("场景值 "+e.scene);var t=JSON.stringify(e.query);console.log("Query参数 "+t);var n=e.query.key;return console.log("Query参数：key "+n),console.log("ShareTicket "+e.shareTicket),console.log("ReferrerInfo.appId "+e.referrerInfo.appId),console.log("ReferrerInfo.extraData "+e.referrerInfo.extraData),e}var a={scene:1001,query:"",shareTicket:"",appId:"",extraData:""};return a},e.SetShareMenu=function(e,t,n,a,o){Laya.Browser.onMiniGame&&(console.log("小游戏设置转发按钮"),Laya.Browser.window.wx.showShareMenu({withShareTicket:!1,success:n,fail:a,complete:o}),Laya.Browser.window.wx.onShareAppMessage(function(){return{title:e,imageUrl:t}}))},e.adUnitId="",e.bannerAdUnitId="",e.InsAdUnitId="",e._isRegRewardedVideoAdEvent=!1,e._onRewardedVideoAdFailed=null,e._onRewardedVideoAdClose=null,e._onShow=null,e._lastShareTime=0,e}();n["default"]=a},{}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=Laya.Scene,i=Laya.ClassUtils.regClass;!function(e){var t;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.uiView)},t.uiView={type:"Scene",props:{width:1080,top:0,right:0,left:0,height:1920,bottom:0},compId:2,child:[{type:"Image",props:{y:-172,x:0,width:1080,skin:"Loading/bg.png",height:2880},compId:9},{type:"Clip",props:{top:0,right:0,name:"Bg",left:0,bottom:0},compId:6,child:[{type:"Image",props:{y:1273,x:258,skin:"Loading/微信图片_201910231521391.png",name:"processBarBg"},compId:8,child:[{type:"Clip",props:{y:24,x:2,width:560,skin:"Loading/微信图片_20191023152139.png",pivotY:22,name:"processBar"},compId:5},{type:"Label",props:{y:-64,x:185,width:194,valign:"middle",text:"0.00%",name:"Value",height:52,fontSize:50,color:"#ffffff",align:"center"},compId:10}]}]},{type:"Script",props:{y:0,x:0,runtime:"View/LoadingView/LoadingView.ts"},compId:7}],loadList:["Loading/bg.png","Loading/微信图片_201910231521391.png","Loading/微信图片_20191023152139.png"],loadList3D:[]},t}(o);e.LoadingUI=t,i("ui.View.LoadingUI",t)}(t=e.View||(e.View={}))}(a=n.ui||(n.ui={}))},{}]},{},[25]);